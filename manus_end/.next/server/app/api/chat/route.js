"use strict";(()=>{var e={};e.id=276,e.ids=[276],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},2834:(e,t,r)=>{let a,s,n;r.r(t),r.d(t,{patchFetch:()=>n0,routeModule:()=>nG,serverHooks:()=>nQ,workAsyncStorage:()=>nH,workUnitAsyncStorage:()=>nX});var i,o,l,u,c,d,p,m,h,f,g,y,v,_,b,x,w,k,T,S,I,E,A,j,N,C,R,O,P,M,Z,$,D,F={};r.r(F),r.d(F,{POST:()=>nY});var q=r(9640),L=r(2525),U=r(6220),z="vercel.ai.error",B=Symbol.for(z),V=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[i]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,z)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};i=B;var J=V,K="AI_APICallError",W=`vercel.ai.error.${K}`,Y=Symbol.for(W),G=class extends J{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:s,responseBody:n,cause:i,isRetryable:l=null!=a&&(408===a||409===a||429===a||a>=500),data:u}){super({name:K,message:e,cause:i}),this[o]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=s,this.responseBody=n,this.isRetryable=l,this.data=u}static isInstance(e){return J.hasMarker(e,W)}};o=Y;var H="AI_EmptyResponseBodyError",X=`vercel.ai.error.${H}`,Q=Symbol.for(X),ee=class extends J{constructor({message:e="Empty response body"}={}){super({name:H,message:e}),this[l]=!0}static isInstance(e){return J.hasMarker(e,X)}};function et(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}l=Q;var er="AI_InvalidArgumentError",ea=`vercel.ai.error.${er}`,es=Symbol.for(ea),en=class extends J{constructor({message:e,cause:t,argument:r}){super({name:er,message:e,cause:t}),this[u]=!0,this.argument=r}static isInstance(e){return J.hasMarker(e,ea)}};u=es;var ei="AI_InvalidPromptError",eo=`vercel.ai.error.${ei}`,el=Symbol.for(eo),eu=class extends J{constructor({prompt:e,message:t,cause:r}){super({name:ei,message:`Invalid prompt: ${t}`,cause:r}),this[c]=!0,this.prompt=e}static isInstance(e){return J.hasMarker(e,eo)}};c=el,Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var ec="AI_JSONParseError",ed=`vercel.ai.error.${ec}`,ep=Symbol.for(ed),em=class extends J{constructor({text:e,cause:t}){super({name:ec,message:`JSON parsing failed: Text: ${e}.
Error message: ${et(t)}`,cause:t}),this[d]=!0,this.text=e}static isInstance(e){return J.hasMarker(e,ed)}};d=ep;var eh="AI_LoadAPIKeyError",ef=`vercel.ai.error.${eh}`,eg=Symbol.for(ef),ey=class extends J{constructor({message:e}){super({name:eh,message:e}),this[p]=!0}static isInstance(e){return J.hasMarker(e,ef)}};p=eg,Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var ev="AI_NoSuchModelError",e_=`vercel.ai.error.${ev}`,eb=Symbol.for(e_),ex=class extends J{constructor({errorName:e=ev,modelId:t,modelType:r,message:a=`No such ${r}: ${t}`}){super({name:e,message:a}),this[m]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return J.hasMarker(e,e_)}};m=eb;var ew="AI_TooManyEmbeddingValuesForCallError",ek=`vercel.ai.error.${ew}`,eT=Symbol.for(ek),eS=class extends J{constructor(e){super({name:ew,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[h]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return J.hasMarker(e,ek)}};h=eT;var eI="AI_TypeValidationError",eE=`vercel.ai.error.${eI}`,eA=Symbol.for(eE),ej=class e extends J{constructor({value:e,cause:t}){super({name:eI,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${et(t)}`,cause:t}),this[f]=!0,this.value=e}static isInstance(e){return J.hasMarker(e,eE)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}};f=eA;var eN="AI_UnsupportedFunctionalityError",eC=`vercel.ai.error.${eN}`,eR=Symbol.for(eC),eO=class extends J{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:eN,message:t}),this[g]=!0,this.functionality=e}static isInstance(e){return J.hasMarker(e,eC)}};function eP(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(eP):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&eP(t)))}g=eR;let eM=(e,t=21)=>(r=t)=>{let a="",s=0|r;for(;s--;)a+=e[Math.random()*e.length|0];return a};var eZ=r(6648);function e$(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}async function eD(e){return null==e?Promise.resolve():new Promise(t=>setTimeout(t,e))}function eF(e){let t={};return e.headers.forEach((e,r)=>{t[r]=e}),t}var eq=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{let s=eM(r,t);if(null==e)return s;if(r.includes(a))throw new en({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return t=>`${e}${a}${s(t)}`},eL=eq();function eU(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}var ez=Symbol.for("vercel.ai.validator");function eB({value:e,schema:t}){let r="object"==typeof t&&null!==t&&ez in t&&!0===t[ez]&&"validate"in t?t:{[ez]:!0,validate:e=>{let r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}};try{if(null==r.validate)return{success:!0,value:e};let t=r.validate(e);if(t.success)return t;return{success:!1,error:ej.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:ej.wrap({value:e,cause:t})}}}function eV({text:e,schema:t}){try{let r=eZ.parse(e);if(null==t)return{success:!0,value:r,rawValue:r};let a=eB({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(t){return{success:!1,error:em.isInstance(t)?t:new em({text:e,cause:t})}}}var eJ=()=>globalThis.fetch,eK=async({url:e,headers:t,body:r,failedResponseHandler:a,successfulResponseHandler:s,abortSignal:n,fetch:i})=>eW({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:a,successfulResponseHandler:s,abortSignal:n,fetch:i}),eW=async({url:e,headers:t={},body:r,successfulResponseHandler:a,failedResponseHandler:s,abortSignal:n,fetch:i=eJ()})=>{try{let o=await i(e,{method:"POST",headers:Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),body:r.content,signal:n}),l=eF(o);if(!o.ok){let t;try{t=await s({response:o,url:e,requestBodyValues:r.values})}catch(t){if(eU(t)||G.isInstance(t))throw t;throw new G({message:"Failed to process error response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw t.value}try{return await a({response:o,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(eU(t)||G.isInstance(t)))throw t;throw new G({message:"Failed to process successful response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(t){if(eU(t))throw t;if(t instanceof TypeError&&"fetch failed"===t.message){let a=t.cause;if(null!=a)throw new G({message:`Cannot connect to API: ${a.message}`,cause:a,url:e,requestBodyValues:r.values,isRetryable:!0})}throw t}},eY=e=>async({response:t})=>{let r=eF(t);if(null==t.body)throw new ee({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(function(){let e,t,r,a="",s=[];function n(e,t){if(""===e){i(t);return}if(e.startsWith(":"))return;let r=e.indexOf(":");if(-1===r){o(e,"");return}let a=e.slice(0,r),s=r+1;o(a,s<e.length&&" "===e[s]?e.slice(s+1):e.slice(s))}function i(a){s.length>0&&(a.enqueue({event:e,data:s.join("\n"),id:t,retry:r}),s=[],e=void 0,r=void 0)}function o(a,n){switch(a){case"event":e=n;break;case"data":s.push(n);break;case"id":t=n;break;case"retry":let i=parseInt(n,10);isNaN(i)||(r=i)}}return new TransformStream({transform(e,t){let{lines:r,incompleteLine:s}=function(e,t){let r=[],a=e;for(let e=0;e<t.length;){let s=t[e++];"\n"===s?(r.push(a),a=""):"\r"===s?(r.push(a),a="","\n"===t[e+1]&&e++):a+=s}return{lines:r,incompleteLine:a}}(a,e);a=s;for(let e=0;e<r.length;e++)n(r[e],t)},flush(e){n(a,e),i(e)}})}()).pipeThrough(new TransformStream({transform({data:t},r){"[DONE]"!==t&&r.enqueue(eV({text:t,schema:e}))}}))}},eG=e=>async({response:t,url:r,requestBodyValues:a})=>{let s=await t.text(),n=eV({text:s,schema:e}),i=eF(t);if(!n.success)throw new G({message:"Invalid JSON response",cause:n.error,statusCode:t.status,responseHeaders:i,responseBody:s,url:r,requestBodyValues:a});return{responseHeaders:i,value:n.value,rawValue:n.rawValue}},{btoa:eH,atob:eX}=globalThis;function eQ(e){let t=eX(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,e=>e.codePointAt(0))}function e0(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return eH(t)}(function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t})(y||(y={})),(v||(v={})).mergeShapes=(e,t)=>({...e,...t});let e1=y.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),e4=e=>{switch(typeof e){case"undefined":return e1.undefined;case"string":return e1.string;case"number":return isNaN(e)?e1.nan:e1.number;case"boolean":return e1.boolean;case"function":return e1.function;case"bigint":return e1.bigint;case"symbol":return e1.symbol;case"object":if(Array.isArray(e))return e1.array;if(null===e)return e1.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return e1.promise;if("undefined"!=typeof Map&&e instanceof Map)return e1.map;if("undefined"!=typeof Set&&e instanceof Set)return e1.set;if("undefined"!=typeof Date&&e instanceof Date)return e1.date;return e1.object;default:return e1.unknown}},e9=y.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class e2 extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(a);else if("invalid_return_type"===s.code)a(s.returnTypeError);else if("invalid_arguments"===s.code)a(s.argumentsError);else if(0===s.path.length)r._errors.push(t(s));else{let e=r,a=0;for(;a<s.path.length;){let r=s.path[a];a===s.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(s))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof e2))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,y.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}e2.create=e=>new e2(e);let e6=(e,t)=>{let r;switch(e.code){case e9.invalid_type:r=e.received===e1.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case e9.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,y.jsonStringifyReplacer)}`;break;case e9.unrecognized_keys:r=`Unrecognized key(s) in object: ${y.joinValues(e.keys,", ")}`;break;case e9.invalid_union:r="Invalid input";break;case e9.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${y.joinValues(e.options)}`;break;case e9.invalid_enum_value:r=`Invalid enum value. Expected ${y.joinValues(e.options)}, received '${e.received}'`;break;case e9.invalid_arguments:r="Invalid function arguments";break;case e9.invalid_return_type:r="Invalid function return type";break;case e9.invalid_date:r="Invalid date";break;case e9.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:y.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case e9.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case e9.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case e9.custom:r="Invalid input";break;case e9.invalid_intersection_types:r="Intersection results could not be merged";break;case e9.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case e9.not_finite:r="Number must be finite";break;default:r=t.defaultError,y.assertNever(e)}return{message:r}},e5=e6;function e3(){return e5}let e7=e=>{let{data:t,path:r,errorMaps:a,issueData:s}=e,n=[...r,...s.path||[]],i={...s,path:n};if(void 0!==s.message)return{...s,path:n,message:s.message};let o="";for(let e of a.filter(e=>!!e).slice().reverse())o=e(i,{data:t,defaultError:o}).message;return{...s,path:n,message:o}};function e8(e,t){let r=e3(),a=e7({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===e6?void 0:e6].filter(e=>!!e)});e.common.issues.push(a)}class te{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return tt;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return te.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:s}=a;if("aborted"===t.status||"aborted"===s.status)return tt;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==s.value||a.alwaysSet)&&(r[t.value]=s.value)}return{status:e.value,value:r}}}let tt=Object.freeze({status:"aborted"}),tr=e=>({status:"dirty",value:e}),ta=e=>({status:"valid",value:e}),ts=e=>"aborted"===e.status,tn=e=>"dirty"===e.status,ti=e=>"valid"===e.status,to=e=>"undefined"!=typeof Promise&&e instanceof Promise;function tl(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function tu(e,t,r,a,s){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?s.call(e,r):s?s.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(_||(_={}));class tc{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let td=(e,t)=>{if(ti(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new e2(e.common.issues);return this._error=t,this._error}}};function tp(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:s}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:s}:{errorMap:(t,s)=>{var n,i;let{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:s.defaultError}:void 0===s.data?{message:null!==(n=null!=o?o:a)&&void 0!==n?n:s.defaultError}:"invalid_type"!==t.code?{message:s.defaultError}:{message:null!==(i=null!=o?o:r)&&void 0!==i?i:s.defaultError}},description:s}}class tm{get description(){return this._def.description}_getType(e){return e4(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:e4(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new te,ctx:{common:e.parent.common,data:e.data,parsedType:e4(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(to(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let a={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:e4(e)},s=this._parseSync({data:e,path:a.path,parent:a});return td(a,s)}"~validate"(e){var t,r;let a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:e4(e)};if(!this["~standard"].async)try{let t=this._parseSync({data:e,path:[],parent:a});return ti(t)?{value:t.value}:{issues:a.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then(e=>ti(e)?{value:e.value}:{issues:a.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:e4(e)},a=this._parse({data:e,path:r.path,parent:r});return td(r,await (to(a)?a:Promise.resolve(a)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let s=e(t),n=()=>a.addIssue({code:e9.custom,...r(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(e=>!!e||(n(),!1)):!!s||(n(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new t3({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return t7.create(this,this._def)}nullable(){return t8.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return tB.create(this)}promise(){return t5.create(this,this._def)}or(e){return tJ.create([this,e],this._def)}and(e){return tY.create(this,e,this._def)}transform(e){return new t3({...tp(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new re({...tp(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:w.ZodDefault})}brand(){return new rs({typeName:w.ZodBranded,type:this,...tp(this._def)})}catch(e){return new rt({...tp(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:w.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return rn.create(this,e)}readonly(){return ri.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let th=/^c[^\s-]{8,}$/i,tf=/^[0-9a-z]+$/,tg=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ty=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,tv=/^[a-z0-9_-]{21}$/i,t_=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,tb=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tx=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,tw=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,tk=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,tT=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,tS=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,tI=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,tE=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,tA="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",tj=RegExp(`^${tA}$`);function tN(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function tC(e){let t=`${tA}T${tN(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class tR extends tm{_parse(e){var t,r,s,n;let i;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==e1.string){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.string,received:t.parsedType}),tt}let o=new te;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(e8(i=this._getOrReturnCtx(e,i),{code:e9.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("max"===l.kind)e.data.length>l.value&&(e8(i=this._getOrReturnCtx(e,i),{code:e9.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(i=this._getOrReturnCtx(e,i),t?e8(i,{code:e9.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&e8(i,{code:e9.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),o.dirty())}else if("email"===l.kind)tx.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"email",code:e9.invalid_string,message:l.message}),o.dirty());else if("emoji"===l.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"emoji",code:e9.invalid_string,message:l.message}),o.dirty());else if("uuid"===l.kind)ty.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"uuid",code:e9.invalid_string,message:l.message}),o.dirty());else if("nanoid"===l.kind)tv.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"nanoid",code:e9.invalid_string,message:l.message}),o.dirty());else if("cuid"===l.kind)th.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"cuid",code:e9.invalid_string,message:l.message}),o.dirty());else if("cuid2"===l.kind)tf.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"cuid2",code:e9.invalid_string,message:l.message}),o.dirty());else if("ulid"===l.kind)tg.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"ulid",code:e9.invalid_string,message:l.message}),o.dirty());else if("url"===l.kind)try{new URL(e.data)}catch(t){e8(i=this._getOrReturnCtx(e,i),{validation:"url",code:e9.invalid_string,message:l.message}),o.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"regex",code:e9.invalid_string,message:l.message}),o.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(e8(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),o.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(e8(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:{startsWith:l.value},message:l.message}),o.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(e8(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:{endsWith:l.value},message:l.message}),o.dirty()):"datetime"===l.kind?tC(l).test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:"datetime",message:l.message}),o.dirty()):"date"===l.kind?tj.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:"date",message:l.message}),o.dirty()):"time"===l.kind?RegExp(`^${tN(l)}$`).test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:"time",message:l.message}),o.dirty()):"duration"===l.kind?tb.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"duration",code:e9.invalid_string,message:l.message}),o.dirty()):"ip"===l.kind?(t=e.data,("v4"===(r=l.version)||!r)&&tw.test(t)||("v6"===r||!r)&&tT.test(t)||(e8(i=this._getOrReturnCtx(e,i),{validation:"ip",code:e9.invalid_string,message:l.message}),o.dirty())):"jwt"===l.kind?!function(e,t){if(!t_.test(e))return!1;try{let[r]=e.split("."),a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(a));if("object"!=typeof s||null===s||!s.typ||!s.alg||t&&s.alg!==t)return!1;return!0}catch(e){return!1}}(e.data,l.alg)&&(e8(i=this._getOrReturnCtx(e,i),{validation:"jwt",code:e9.invalid_string,message:l.message}),o.dirty()):"cidr"===l.kind?(s=e.data,("v4"===(n=l.version)||!n)&&tk.test(s)||("v6"===n||!n)&&tS.test(s)||(e8(i=this._getOrReturnCtx(e,i),{validation:"cidr",code:e9.invalid_string,message:l.message}),o.dirty())):"base64"===l.kind?tI.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"base64",code:e9.invalid_string,message:l.message}),o.dirty()):"base64url"===l.kind?tE.test(e.data)||(e8(i=this._getOrReturnCtx(e,i),{validation:"base64url",code:e9.invalid_string,message:l.message}),o.dirty()):y.assertNever(l);return{status:o.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:e9.invalid_string,..._.errToObj(r)})}_addCheck(e){return new tR({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",..._.errToObj(e)})}url(e){return this._addCheck({kind:"url",..._.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",..._.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",..._.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",..._.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",..._.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",..._.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",..._.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",..._.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",..._.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",..._.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",..._.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",..._.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,..._.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,..._.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",..._.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,..._.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,..._.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,..._.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,..._.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,..._.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,..._.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,..._.errToObj(t)})}nonempty(e){return this.min(1,_.errToObj(e))}trim(){return new tR({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new tR({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new tR({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}tR.create=e=>{var t;return new tR({checks:[],typeName:w.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...tp(e)})};class tO extends tm{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==e1.number){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.number,received:t.parsedType}),tt}let r=new te;for(let a of this._def.checks)"int"===a.kind?y.isInteger(e.data)||(e8(t=this._getOrReturnCtx(e,t),{code:e9.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(e8(t=this._getOrReturnCtx(e,t),{code:e9.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(e8(t=this._getOrReturnCtx(e,t),{code:e9.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"multipleOf"===a.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,s=r>a?r:a;return parseInt(e.toFixed(s).replace(".",""))%parseInt(t.toFixed(s).replace(".",""))/Math.pow(10,s)}(e.data,a.value)&&(e8(t=this._getOrReturnCtx(e,t),{code:e9.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(e8(t=this._getOrReturnCtx(e,t),{code:e9.not_finite,message:a.message}),r.dirty()):y.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,r,a){return new tO({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:_.toString(a)}]})}_addCheck(e){return new tO({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:_.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:_.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&y.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}tO.create=e=>new tO({checks:[],typeName:w.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...tp(e)});class tP extends tm{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==e1.bigint)return this._getInvalidInput(e);let r=new te;for(let a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(e8(t=this._getOrReturnCtx(e,t),{code:e9.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(e8(t=this._getOrReturnCtx(e,t),{code:e9.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(e8(t=this._getOrReturnCtx(e,t),{code:e9.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):y.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.bigint,received:t.parsedType}),tt}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,r,a){return new tP({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:_.toString(a)}]})}_addCheck(e){return new tP({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}tP.create=e=>{var t;return new tP({checks:[],typeName:w.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...tp(e)})};class tM extends tm{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==e1.boolean){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.boolean,received:t.parsedType}),tt}return ta(e.data)}}tM.create=e=>new tM({typeName:w.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...tp(e)});class tZ extends tm{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==e1.date){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.date,received:t.parsedType}),tt}if(isNaN(e.data.getTime()))return e8(this._getOrReturnCtx(e),{code:e9.invalid_date}),tt;let r=new te;for(let a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(e8(t=this._getOrReturnCtx(e,t),{code:e9.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(e8(t=this._getOrReturnCtx(e,t),{code:e9.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):y.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new tZ({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:_.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:_.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}tZ.create=e=>new tZ({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:w.ZodDate,...tp(e)});class t$ extends tm{_parse(e){if(this._getType(e)!==e1.symbol){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.symbol,received:t.parsedType}),tt}return ta(e.data)}}t$.create=e=>new t$({typeName:w.ZodSymbol,...tp(e)});class tD extends tm{_parse(e){if(this._getType(e)!==e1.undefined){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.undefined,received:t.parsedType}),tt}return ta(e.data)}}tD.create=e=>new tD({typeName:w.ZodUndefined,...tp(e)});class tF extends tm{_parse(e){if(this._getType(e)!==e1.null){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.null,received:t.parsedType}),tt}return ta(e.data)}}tF.create=e=>new tF({typeName:w.ZodNull,...tp(e)});class tq extends tm{constructor(){super(...arguments),this._any=!0}_parse(e){return ta(e.data)}}tq.create=e=>new tq({typeName:w.ZodAny,...tp(e)});class tL extends tm{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ta(e.data)}}tL.create=e=>new tL({typeName:w.ZodUnknown,...tp(e)});class tU extends tm{_parse(e){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.never,received:t.parsedType}),tt}}tU.create=e=>new tU({typeName:w.ZodNever,...tp(e)});class tz extends tm{_parse(e){if(this._getType(e)!==e1.undefined){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.void,received:t.parsedType}),tt}return ta(e.data)}}tz.create=e=>new tz({typeName:w.ZodVoid,...tp(e)});class tB extends tm{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==e1.array)return e8(t,{code:e9.invalid_type,expected:e1.array,received:t.parsedType}),tt;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,s=t.data.length<a.exactLength.value;(e||s)&&(e8(t,{code:e?e9.too_big:e9.too_small,minimum:s?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(e8(t,{code:e9.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(e8(t,{code:e9.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new tc(t,e,t.path,r)))).then(e=>te.mergeArray(r,e));let s=[...t.data].map((e,r)=>a.type._parseSync(new tc(t,e,t.path,r)));return te.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new tB({...this._def,minLength:{value:e,message:_.toString(t)}})}max(e,t){return new tB({...this._def,maxLength:{value:e,message:_.toString(t)}})}length(e,t){return new tB({...this._def,exactLength:{value:e,message:_.toString(t)}})}nonempty(e){return this.min(1,e)}}tB.create=(e,t)=>new tB({type:e,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...tp(t)});class tV extends tm{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=y.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==e1.object){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.object,received:t.parsedType}),tt}let{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),n=[];if(!(this._def.catchall instanceof tU&&"strip"===this._def.unknownKeys))for(let e in r.data)s.includes(e)||n.push(e);let i=[];for(let e of s){let t=a[e],s=r.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new tc(r,s,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof tU){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of n)i.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)n.length>0&&(e8(r,{code:e9.unrecognized_keys,keys:n}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of n){let a=r.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new tc(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of i){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>te.mergeObjectSync(t,e)):te.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return _.errToObj,new tV({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,s,n,i;let o=null!==(n=null===(s=(a=this._def).errorMap)||void 0===s?void 0:s.call(a,t,r).message)&&void 0!==n?n:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(i=_.errToObj(e).message)&&void 0!==i?i:o}:{message:o}}}:{}})}strip(){return new tV({...this._def,unknownKeys:"strip"})}passthrough(){return new tV({...this._def,unknownKeys:"passthrough"})}extend(e){return new tV({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new tV({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new tV({...this._def,catchall:e})}pick(e){let t={};return y.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new tV({...this._def,shape:()=>t})}omit(e){let t={};return y.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new tV({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof tV){let r={};for(let a in t.shape){let s=t.shape[a];r[a]=t7.create(e(s))}return new tV({...t._def,shape:()=>r})}return t instanceof tB?new tB({...t._def,type:e(t.element)}):t instanceof t7?t7.create(e(t.unwrap())):t instanceof t8?t8.create(e(t.unwrap())):t instanceof tG?tG.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};return y.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new tV({...this._def,shape:()=>t})}required(e){let t={};return y.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof t7;)e=e._def.innerType;t[r]=e}}),new tV({...this._def,shape:()=>t})}keyof(){return t9(y.objectKeys(this.shape))}}tV.create=(e,t)=>new tV({shape:()=>e,unknownKeys:"strip",catchall:tU.create(),typeName:w.ZodObject,...tp(t)}),tV.strictCreate=(e,t)=>new tV({shape:()=>e,unknownKeys:"strict",catchall:tU.create(),typeName:w.ZodObject,...tp(t)}),tV.lazycreate=(e,t)=>new tV({shape:e,unknownKeys:"strip",catchall:tU.create(),typeName:w.ZodObject,...tp(t)});class tJ extends tm{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new e2(e.ctx.common.issues));return e8(t,{code:e9.invalid_union,unionErrors:r}),tt});{let e;let a=[];for(let s of r){let r={...t,common:{...t.common,issues:[]},parent:null},n=s._parseSync({data:t.data,path:t.path,parent:r});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let s=a.map(e=>new e2(e));return e8(t,{code:e9.invalid_union,unionErrors:s}),tt}}get options(){return this._def.options}}tJ.create=(e,t)=>new tJ({options:e,typeName:w.ZodUnion,...tp(t)});let tK=e=>{if(e instanceof t1)return tK(e.schema);if(e instanceof t3)return tK(e.innerType());if(e instanceof t4)return[e.value];if(e instanceof t2)return e.options;if(e instanceof t6)return y.objectValues(e.enum);if(e instanceof re)return tK(e._def.innerType);if(e instanceof tD)return[void 0];else if(e instanceof tF)return[null];else if(e instanceof t7)return[void 0,...tK(e.unwrap())];else if(e instanceof t8)return[null,...tK(e.unwrap())];else if(e instanceof rs)return tK(e.unwrap());else if(e instanceof ri)return tK(e.unwrap());else if(e instanceof rt)return tK(e._def.innerType);else return[]};class tW extends tm{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==e1.object)return e8(t,{code:e9.invalid_type,expected:e1.object,received:t.parsedType}),tt;let r=this.discriminator,a=t.data[r],s=this.optionsMap.get(a);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(e8(t,{code:e9.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),tt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=tK(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let s of t){if(a.has(s))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);a.set(s,r)}}return new tW({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...tp(r)})}}class tY extends tm{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(ts(e)||ts(a))return tt;let s=function e(t,r){let a=e4(t),s=e4(r);if(t===r)return{valid:!0,data:t};if(a===e1.object&&s===e1.object){let a=y.objectKeys(r),s=y.objectKeys(t).filter(e=>-1!==a.indexOf(e)),n={...t,...r};for(let a of s){let s=e(t[a],r[a]);if(!s.valid)return{valid:!1};n[a]=s.data}return{valid:!0,data:n}}if(a===e1.array&&s===e1.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let s=0;s<t.length;s++){let n=e(t[s],r[s]);if(!n.valid)return{valid:!1};a.push(n.data)}return{valid:!0,data:a}}return a===e1.date&&s===e1.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,a.value);return s.valid?((tn(e)||tn(a))&&t.dirty(),{status:t.value,value:s.data}):(e8(r,{code:e9.invalid_intersection_types}),tt)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}tY.create=(e,t,r)=>new tY({left:e,right:t,typeName:w.ZodIntersection,...tp(r)});class tG extends tm{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e1.array)return e8(r,{code:e9.invalid_type,expected:e1.array,received:r.parsedType}),tt;if(r.data.length<this._def.items.length)return e8(r,{code:e9.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),tt;!this._def.rest&&r.data.length>this._def.items.length&&(e8(r,{code:e9.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new tc(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(a).then(e=>te.mergeArray(t,e)):te.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new tG({...this._def,rest:e})}}tG.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new tG({items:e,typeName:w.ZodTuple,rest:null,...tp(t)})};class tH extends tm{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e1.object)return e8(r,{code:e9.invalid_type,expected:e1.object,received:r.parsedType}),tt;let a=[],s=this._def.keyType,n=this._def.valueType;for(let e in r.data)a.push({key:s._parse(new tc(r,e,r.path,e)),value:n._parse(new tc(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?te.mergeObjectAsync(t,a):te.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new tH(t instanceof tm?{keyType:e,valueType:t,typeName:w.ZodRecord,...tp(r)}:{keyType:tR.create(),valueType:e,typeName:w.ZodRecord,...tp(t)})}}class tX extends tm{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e1.map)return e8(r,{code:e9.invalid_type,expected:e1.map,received:r.parsedType}),tt;let a=this._def.keyType,s=this._def.valueType,n=[...r.data.entries()].map(([e,t],n)=>({key:a._parse(new tc(r,e,r.path,[n,"key"])),value:s._parse(new tc(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of n){let a=await r.key,s=await r.value;if("aborted"===a.status||"aborted"===s.status)return tt;("dirty"===a.status||"dirty"===s.status)&&t.dirty(),e.set(a.value,s.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of n){let a=r.key,s=r.value;if("aborted"===a.status||"aborted"===s.status)return tt;("dirty"===a.status||"dirty"===s.status)&&t.dirty(),e.set(a.value,s.value)}return{status:t.value,value:e}}}}tX.create=(e,t,r)=>new tX({valueType:t,keyType:e,typeName:w.ZodMap,...tp(r)});class tQ extends tm{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e1.set)return e8(r,{code:e9.invalid_type,expected:e1.set,received:r.parsedType}),tt;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(e8(r,{code:e9.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(e8(r,{code:e9.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let s=this._def.valueType;function n(e){let r=new Set;for(let a of e){if("aborted"===a.status)return tt;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let i=[...r.data.values()].map((e,t)=>s._parse(new tc(r,e,r.path,t)));return r.common.async?Promise.all(i).then(e=>n(e)):n(i)}min(e,t){return new tQ({...this._def,minSize:{value:e,message:_.toString(t)}})}max(e,t){return new tQ({...this._def,maxSize:{value:e,message:_.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}tQ.create=(e,t)=>new tQ({valueType:e,minSize:null,maxSize:null,typeName:w.ZodSet,...tp(t)});class t0 extends tm{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==e1.function)return e8(t,{code:e9.invalid_type,expected:e1.function,received:t.parsedType}),tt;function r(e,r){return e7({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,e3(),e6].filter(e=>!!e),issueData:{code:e9.invalid_arguments,argumentsError:r}})}function a(e,r){return e7({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,e3(),e6].filter(e=>!!e),issueData:{code:e9.invalid_return_type,returnTypeError:r}})}let s={errorMap:t.common.contextualErrorMap},n=t.data;if(this._def.returns instanceof t5){let e=this;return ta(async function(...t){let i=new e2([]),o=await e._def.args.parseAsync(t,s).catch(e=>{throw i.addIssue(r(t,e)),i}),l=await Reflect.apply(n,this,o);return await e._def.returns._def.type.parseAsync(l,s).catch(e=>{throw i.addIssue(a(l,e)),i})})}{let e=this;return ta(function(...t){let i=e._def.args.safeParse(t,s);if(!i.success)throw new e2([r(t,i.error)]);let o=Reflect.apply(n,this,i.data),l=e._def.returns.safeParse(o,s);if(!l.success)throw new e2([a(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t0({...this._def,args:tG.create(e).rest(tL.create())})}returns(e){return new t0({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new t0({args:e||tG.create([]).rest(tL.create()),returns:t||tL.create(),typeName:w.ZodFunction,...tp(r)})}}class t1 extends tm{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}t1.create=(e,t)=>new t1({getter:e,typeName:w.ZodLazy,...tp(t)});class t4 extends tm{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return e8(t,{received:t.data,code:e9.invalid_literal,expected:this._def.value}),tt}return{status:"valid",value:e.data}}get value(){return this._def.value}}function t9(e,t){return new t2({values:e,typeName:w.ZodEnum,...tp(t)})}t4.create=(e,t)=>new t4({value:e,typeName:w.ZodLiteral,...tp(t)});class t2 extends tm{constructor(){super(...arguments),b.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return e8(t,{expected:y.joinValues(r),received:t.parsedType,code:e9.invalid_type}),tt}if(tl(this,b,"f")||tu(this,b,new Set(this._def.values),"f"),!tl(this,b,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return e8(t,{received:t.data,code:e9.invalid_enum_value,options:r}),tt}return ta(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return t2.create(e,{...this._def,...t})}exclude(e,t=this._def){return t2.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}b=new WeakMap,t2.create=t9;class t6 extends tm{constructor(){super(...arguments),x.set(this,void 0)}_parse(e){let t=y.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==e1.string&&r.parsedType!==e1.number){let e=y.objectValues(t);return e8(r,{expected:y.joinValues(e),received:r.parsedType,code:e9.invalid_type}),tt}if(tl(this,x,"f")||tu(this,x,new Set(y.getValidEnumValues(this._def.values)),"f"),!tl(this,x,"f").has(e.data)){let e=y.objectValues(t);return e8(r,{received:r.data,code:e9.invalid_enum_value,options:e}),tt}return ta(e.data)}get enum(){return this._def.values}}x=new WeakMap,t6.create=(e,t)=>new t6({values:e,typeName:w.ZodNativeEnum,...tp(t)});class t5 extends tm{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==e1.promise&&!1===t.common.async?(e8(t,{code:e9.invalid_type,expected:e1.promise,received:t.parsedType}),tt):ta((t.parsedType===e1.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}t5.create=(e,t)=>new t5({type:e,typeName:w.ZodPromise,...tp(t)});class t3 extends tm{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:e=>{e8(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===a.type){let e=a.transform(r.data,s);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return tt;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?tt:"dirty"===a.status||"dirty"===t.value?tr(a.value):a});{if("aborted"===t.value)return tt;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?tt:"dirty"===a.status||"dirty"===t.value?tr(a.value):a}}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,s);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?tt:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?tt:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>ti(e)?Promise.resolve(a.transform(e.value,s)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!ti(e))return e;let n=a.transform(e.value,s);if(n instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}}y.assertNever(a)}}t3.create=(e,t,r)=>new t3({schema:e,typeName:w.ZodEffects,effect:t,...tp(r)}),t3.createWithPreprocess=(e,t,r)=>new t3({schema:t,effect:{type:"preprocess",transform:e},typeName:w.ZodEffects,...tp(r)});class t7 extends tm{_parse(e){return this._getType(e)===e1.undefined?ta(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t7.create=(e,t)=>new t7({innerType:e,typeName:w.ZodOptional,...tp(t)});class t8 extends tm{_parse(e){return this._getType(e)===e1.null?ta(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t8.create=(e,t)=>new t8({innerType:e,typeName:w.ZodNullable,...tp(t)});class re extends tm{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===e1.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}re.create=(e,t)=>new re({innerType:e,typeName:w.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...tp(t)});class rt extends tm{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return to(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new e2(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new e2(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}rt.create=(e,t)=>new rt({innerType:e,typeName:w.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...tp(t)});class rr extends tm{_parse(e){if(this._getType(e)!==e1.nan){let t=this._getOrReturnCtx(e);return e8(t,{code:e9.invalid_type,expected:e1.nan,received:t.parsedType}),tt}return{status:"valid",value:e.data}}}rr.create=e=>new rr({typeName:w.ZodNaN,...tp(e)});let ra=Symbol("zod_brand");class rs extends tm{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class rn extends tm{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?tt:"dirty"===e.status?(t.dirty(),tr(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?tt:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new rn({in:e,out:t,typeName:w.ZodPipeline})}}class ri extends tm{_parse(e){let t=this._def.innerType._parse(e),r=e=>(ti(e)&&(e.value=Object.freeze(e.value)),e);return to(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function ro(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function rl(e,t={},r){return e?tq.create().superRefine((a,s)=>{var n,i;let o=e(a);if(o instanceof Promise)return o.then(e=>{var n,i;if(!e){let e=ro(t,a),o=null===(i=null!==(n=e.fatal)&&void 0!==n?n:r)||void 0===i||i;s.addIssue({code:"custom",...e,fatal:o})}});if(!o){let e=ro(t,a),o=null===(i=null!==(n=e.fatal)&&void 0!==n?n:r)||void 0===i||i;s.addIssue({code:"custom",...e,fatal:o})}}):tq.create()}ri.create=(e,t)=>new ri({innerType:e,typeName:w.ZodReadonly,...tp(t)});let ru={object:tV.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(w||(w={}));let rc=tR.create,rd=tO.create,rp=rr.create,rm=tP.create,rh=tM.create,rf=tZ.create,rg=t$.create,ry=tD.create,rv=tF.create,r_=tq.create,rb=tL.create,rx=tU.create,rw=tz.create,rk=tB.create,rT=tV.create,rS=tV.strictCreate,rI=tJ.create,rE=tW.create,rA=tY.create,rj=tG.create,rN=tH.create,rC=tX.create,rR=tQ.create,rO=t0.create,rP=t1.create,rM=t4.create,rZ=t2.create,r$=t6.create,rD=t5.create,rF=t3.create,rq=t7.create,rL=t8.create,rU=t3.createWithPreprocess,rz=rn.create;var rB=Object.freeze({__proto__:null,defaultErrorMap:e6,setErrorMap:function(e){e5=e},getErrorMap:e3,makeIssue:e7,EMPTY_PATH:[],addIssueToContext:e8,ParseStatus:te,INVALID:tt,DIRTY:tr,OK:ta,isAborted:ts,isDirty:tn,isValid:ti,isAsync:to,get util(){return y},get objectUtil(){return v},ZodParsedType:e1,getParsedType:e4,ZodType:tm,datetimeRegex:tC,ZodString:tR,ZodNumber:tO,ZodBigInt:tP,ZodBoolean:tM,ZodDate:tZ,ZodSymbol:t$,ZodUndefined:tD,ZodNull:tF,ZodAny:tq,ZodUnknown:tL,ZodNever:tU,ZodVoid:tz,ZodArray:tB,ZodObject:tV,ZodUnion:tJ,ZodDiscriminatedUnion:tW,ZodIntersection:tY,ZodTuple:tG,ZodRecord:tH,ZodMap:tX,ZodSet:tQ,ZodFunction:t0,ZodLazy:t1,ZodLiteral:t4,ZodEnum:t2,ZodNativeEnum:t6,ZodPromise:t5,ZodEffects:t3,ZodTransformer:t3,ZodOptional:t7,ZodNullable:t8,ZodDefault:re,ZodCatch:rt,ZodNaN:rr,BRAND:ra,ZodBranded:rs,ZodPipeline:rn,ZodReadonly:ri,custom:rl,Schema:tm,ZodSchema:tm,late:ru,get ZodFirstPartyTypeKind(){return w},coerce:{string:e=>tR.create({...e,coerce:!0}),number:e=>tO.create({...e,coerce:!0}),boolean:e=>tM.create({...e,coerce:!0}),bigint:e=>tP.create({...e,coerce:!0}),date:e=>tZ.create({...e,coerce:!0})},any:r_,array:rk,bigint:rm,boolean:rh,date:rf,discriminatedUnion:rE,effect:rF,enum:rZ,function:rO,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>rl(t=>t instanceof e,t),intersection:rA,lazy:rP,literal:rM,map:rC,nan:rp,nativeEnum:r$,never:rx,null:rv,nullable:rL,number:rd,object:rT,oboolean:()=>rh().optional(),onumber:()=>rd().optional(),optional:rq,ostring:()=>rc().optional(),pipeline:rz,preprocess:rU,promise:rD,record:rN,set:rR,strictObject:rS,string:rc,symbol:rg,transformer:rF,tuple:rj,undefined:ry,union:rI,unknown:rb,void:rw,NEVER:tt,ZodIssueCode:e9,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:e2});function rV(e){switch(e){case"stop":return"stop";case"length":case"model_length":return"length";case"tool_calls":return"tool-calls";default:return"unknown"}}var rJ=(({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:a,url:s,requestBodyValues:n})=>{let i=await a.text(),o=eF(a);if(""===i.trim())return{responseHeaders:o,value:new G({message:a.statusText,url:s,requestBodyValues:n,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})};try{let l=function({text:e,schema:t}){try{let r=eZ.parse(e);if(null==t)return r;return function({value:e,schema:t}){let r=eB({value:e,schema:t});if(!r.success)throw ej.wrap({value:e,cause:r.error});return r.value}({value:r,schema:t})}catch(t){if(em.isInstance(t)||ej.isInstance(t))throw t;throw new em({text:e,cause:t})}}({text:i,schema:e});return{responseHeaders:o,value:new G({message:t(l),url:s,requestBodyValues:n,statusCode:a.status,responseHeaders:o,responseBody:i,data:l,isRetryable:null==r?void 0:r(a,l)})}}catch(e){return{responseHeaders:o,value:new G({message:a.statusText,url:s,requestBodyValues:n,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})}}})({errorSchema:rB.object({object:rB.literal("error"),message:rB.string(),type:rB.string(),param:rB.string().nullable(),code:rB.string().nullable()}),errorToMessage:e=>e.message});function rK({id:e,model:t,created:r}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=r?new Date(1e3*r):void 0}}var rW=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}supportsUrl(e){return"https:"===e.protocol}getArgs({mode:e,prompt:t,maxTokens:r,temperature:a,topP:s,topK:n,frequencyPenalty:i,presencePenalty:o,stopSequences:l,responseFormat:u,seed:c,providerMetadata:d}){var p,m;let h=e.type,f=[];null!=n&&f.push({type:"unsupported-setting",setting:"topK"}),null!=i&&f.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=o&&f.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=l&&f.push({type:"unsupported-setting",setting:"stopSequences"}),null!=u&&"json"===u.type&&null!=u.schema&&f.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is not supported"});let g={model:this.modelId,safe_prompt:this.settings.safePrompt,max_tokens:r,temperature:a,top_p:s,random_seed:c,response_format:(null==u?void 0:u.type)==="json"?{type:"json_object"}:void 0,document_image_limit:null==(p=null==d?void 0:d.mistral)?void 0:p.documentImageLimit,document_page_limit:null==(m=null==d?void 0:d.mistral)?void 0:m.documentPageLimit,messages:function(e){let t=[];for(let r=0;r<e.length;r++){let{role:a,content:s}=e[r],n=r===e.length-1;switch(a){case"system":t.push({role:"system",content:s});break;case"user":t.push({role:"user",content:s.map(e=>{var t;switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:e.image instanceof URL?e.image.toString():`data:${null!=(t=e.mimeType)?t:"image/jpeg"};base64,${e0(e.image)}`};case"file":if(!(e.data instanceof URL))throw new eO({functionality:"File content parts in user messages"});if("application/pdf"===e.mimeType)return{type:"document_url",document_url:e.data.toString()};throw new eO({functionality:"Only PDF files are supported in user messages"})}})});break;case"assistant":{let e="",r=[];for(let t of s)switch(t.type){case"text":e+=t.text;break;case"tool-call":r.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.args)}})}t.push({role:"assistant",content:e,prefix:!!n||void 0,tool_calls:r.length>0?r:void 0});break}case"tool":for(let e of s)t.push({role:"tool",name:e.toolName,content:JSON.stringify(e.result),tool_call_id:e.toolCallId});break;default:throw Error(`Unsupported role: ${a}`)}}return t}(t)};switch(h){case"regular":{let{tools:t,tool_choice:r,toolWarnings:a}=function(e){var t;let r=(null==(t=e.tools)?void 0:t.length)?e.tools:void 0,a=[];if(null==r)return{tools:void 0,tool_choice:void 0,toolWarnings:a};let s=[];for(let e of r)"provider-defined"===e.type?a.push({type:"unsupported-tool",tool:e}):s.push({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters}});let n=e.toolChoice;if(null==n)return{tools:s,tool_choice:void 0,toolWarnings:a};let i=n.type;switch(i){case"auto":case"none":return{tools:s,tool_choice:i,toolWarnings:a};case"required":return{tools:s,tool_choice:"any",toolWarnings:a};case"tool":return{tools:s.filter(e=>e.function.name===n.toolName),tool_choice:"any",toolWarnings:a};default:throw new eO({functionality:`Unsupported tool choice type: ${i}`})}}(e);return{args:{...g,tools:t,tool_choice:r},warnings:[...f,...a]}}case"object-json":return{args:{...g,response_format:{type:"json_object"}},warnings:f};case"object-tool":return{args:{...g,tool_choice:"any",tools:[{type:"function",function:e.tool}]},warnings:f};default:throw Error(`Unsupported type: ${h}`)}}async doGenerate(e){var t;let{args:r,warnings:a}=this.getArgs(e),{responseHeaders:s,value:n,rawValue:i}=await eK({url:`${this.config.baseURL}/chat/completions`,headers:e$(this.config.headers(),e.headers),body:r,failedResponseHandler:rJ,successfulResponseHandler:eG(rH),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...l}=r,u=n.choices[0],c=rY(u.message.content),d=o[o.length-1];return"assistant"===d.role&&(null==c?void 0:c.startsWith(d.content))&&(c=c.slice(d.content.length)),{text:c,toolCalls:null==(t=u.message.tool_calls)?void 0:t.map(e=>({toolCallType:"function",toolCallId:e.id,toolName:e.function.name,args:e.function.arguments})),finishReason:rV(u.finish_reason),usage:{promptTokens:n.usage.prompt_tokens,completionTokens:n.usage.completion_tokens},rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:s,body:i},request:{body:JSON.stringify(r)},response:rK(n),warnings:a}}async doStream(e){let{args:t,warnings:r}=this.getArgs(e),a={...t,stream:!0},{responseHeaders:s,value:n}=await eK({url:`${this.config.baseURL}/chat/completions`,headers:e$(this.config.headers(),e.headers),body:a,failedResponseHandler:rJ,successfulResponseHandler:eY(rX),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:i,...o}=t,l="unknown",u={promptTokens:Number.NaN,completionTokens:Number.NaN},c=0,d=!1;return{stream:n.pipeThrough(new TransformStream({transform(e,t){if(!e.success){t.enqueue({type:"error",error:e.error});return}c++;let r=e.value;1===c&&t.enqueue({type:"response-metadata",...rK(r)}),null!=r.usage&&(u={promptTokens:r.usage.prompt_tokens,completionTokens:r.usage.completion_tokens});let a=r.choices[0];if((null==a?void 0:a.finish_reason)!=null&&(l=rV(a.finish_reason)),(null==a?void 0:a.delta)==null)return;let s=a.delta,n=rY(s.content);if(c<=2){let e=i[i.length-1];if("assistant"===e.role&&n===e.content.trimEnd()){n.length<e.content.length&&(d=!0);return}}if(null!=n&&(t.enqueue({type:"text-delta",textDelta:d?n.trimStart():n}),d=!1),null!=s.tool_calls)for(let e of s.tool_calls)t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:e.id,toolName:e.function.name,argsTextDelta:e.function.arguments}),t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:e.id,toolName:e.function.name,args:e.function.arguments})},flush(e){e.enqueue({type:"finish",finishReason:l,usage:u})}})),rawCall:{rawPrompt:i,rawSettings:o},rawResponse:{headers:s},request:{body:JSON.stringify(a)},warnings:r}}};function rY(e){if("string"==typeof e)return e;if(null==e)return;let t=[];for(let r of e){let{type:e}=r;switch(e){case"text":t.push(r.text);break;case"image_url":case"reference":break;default:throw Error(`Unsupported type: ${e}`)}}return t.length?t.join(""):void 0}var rG=rB.union([rB.string(),rB.array(rB.discriminatedUnion("type",[rB.object({type:rB.literal("text"),text:rB.string()}),rB.object({type:rB.literal("image_url"),image_url:rB.union([rB.string(),rB.object({url:rB.string(),detail:rB.string().nullable()})])}),rB.object({type:rB.literal("reference"),reference_ids:rB.array(rB.number())})]))]).nullish(),rH=rB.object({id:rB.string().nullish(),created:rB.number().nullish(),model:rB.string().nullish(),choices:rB.array(rB.object({message:rB.object({role:rB.literal("assistant"),content:rG,tool_calls:rB.array(rB.object({id:rB.string(),function:rB.object({name:rB.string(),arguments:rB.string()})})).nullish()}),index:rB.number(),finish_reason:rB.string().nullish()})),object:rB.literal("chat.completion"),usage:rB.object({prompt_tokens:rB.number(),completion_tokens:rB.number()})}),rX=rB.object({id:rB.string().nullish(),created:rB.number().nullish(),model:rB.string().nullish(),choices:rB.array(rB.object({delta:rB.object({role:rB.enum(["assistant"]).optional(),content:rG,tool_calls:rB.array(rB.object({id:rB.string(),function:rB.object({name:rB.string(),arguments:rB.string()})})).nullish()}),finish_reason:rB.string().nullish(),index:rB.number()})),usage:rB.object({prompt_tokens:rB.number(),completion_tokens:rB.number()}).nullish()}),rQ=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.settings.maxEmbeddingsPerCall)?e:32}get supportsParallelCalls(){var e;return null!=(e=this.settings.supportsParallelCalls)&&e}async doEmbed({values:e,abortSignal:t,headers:r}){if(e.length>this.maxEmbeddingsPerCall)throw new eS({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:a,value:s}=await eK({url:`${this.config.baseURL}/embeddings`,headers:e$(this.config.headers(),r),body:{model:this.modelId,input:e,encoding_format:"float"},failedResponseHandler:rJ,successfulResponseHandler:eG(r0),abortSignal:t,fetch:this.config.fetch});return{embeddings:s.data.map(e=>e.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,rawResponse:{headers:a}}}},r0=rB.object({data:rB.array(rB.object({embedding:rB.array(rB.number())})),usage:rB.object({prompt_tokens:rB.number()}).nullish()});function r1(e={}){var t,r;let a=null!=(t=null==(r=e.baseURL)?void 0:r.replace(/\/$/,""))?t:"https://api.mistral.ai/v1",s=()=>({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:a}){if("string"==typeof e)return e;if(null!=e)throw new ey({message:`${a} API key must be a string.`});if("undefined"==typeof process)throw new ey({message:`${a} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new ey({message:`${a} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new ey({message:`${a} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"MISTRAL_API_KEY",description:"Mistral"})}`,...e.headers}),n=(t,r={})=>new rW(t,r,{provider:"mistral.chat",baseURL:a,headers:s,fetch:e.fetch}),i=(t,r={})=>new rQ(t,r,{provider:"mistral.embedding",baseURL:a,headers:s,fetch:e.fetch}),o=function(e,t){if(new.target)throw Error("The Mistral model function cannot be called with the new keyword.");return n(e,t)};return o.languageModel=n,o.chat=n,o.embedding=i,o.textEmbedding=i,o.textEmbeddingModel=i,o}r1();var r4=r(2019),r9=r(1216);let r2=Symbol("Let zodToJsonSchema decide on which parser to use"),r6={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},r5=e=>"string"==typeof e?{...r6,name:e}:{...r6,...e},r3=e=>{let t=r5(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function r7(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function r8(e,t,r,a,s){e[t]=r,r7(e,t,a,s)}function ae(e,t){return av(e.type._def,t)}let at=(e,t)=>av(e.innerType._def,t),ar=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let a of e.checks)switch(a.kind){case"min":r8(r,"minimum",a.value,a.message,t);break;case"max":r8(r,"maximum",a.value,a.message,t)}return r},aa=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,as={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===n&&(n=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),n),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function an(e,t){let r={type:"string"};if(e.checks)for(let a of e.checks)switch(a.kind){case"min":r8(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":r8(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":al(r,"email",a.message,t);break;case"format:idn-email":al(r,"idn-email",a.message,t);break;case"pattern:zod":au(r,as.email,a.message,t)}break;case"url":al(r,"uri",a.message,t);break;case"uuid":al(r,"uuid",a.message,t);break;case"regex":au(r,a.regex,a.message,t);break;case"cuid":au(r,as.cuid,a.message,t);break;case"cuid2":au(r,as.cuid2,a.message,t);break;case"startsWith":au(r,RegExp(`^${ai(a.value,t)}`),a.message,t);break;case"endsWith":au(r,RegExp(`${ai(a.value,t)}$`),a.message,t);break;case"datetime":al(r,"date-time",a.message,t);break;case"date":al(r,"date",a.message,t);break;case"time":al(r,"time",a.message,t);break;case"duration":al(r,"duration",a.message,t);break;case"length":r8(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),r8(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":au(r,RegExp(ai(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&al(r,"ipv4",a.message,t),"v4"!==a.version&&al(r,"ipv6",a.message,t);break;case"base64url":au(r,as.base64url,a.message,t);break;case"jwt":au(r,as.jwt,a.message,t);break;case"cidr":"v6"!==a.version&&au(r,as.ipv4Cidr,a.message,t),"v4"!==a.version&&au(r,as.ipv6Cidr,a.message,t);break;case"emoji":au(r,as.emoji(),a.message,t);break;case"ulid":au(r,as.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":al(r,"binary",a.message,t);break;case"contentEncoding:base64":r8(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":au(r,as.base64,a.message,t)}break;case"nanoid":au(r,as.nanoid,a.message,t)}return r}function ai(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)ao.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let ao=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function al(e,t,r,a){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):r8(e,"format",t,r,a)}function au(e,t,r,a){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:ac(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):r8(e,"pattern",ac(t,a),r,a)}function ac(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source,s="",n=!1,i=!1,o=!1;for(let e=0;e<a.length;e++){if(n){s+=a[e],n=!1;continue}if(r.i){if(i){if(a[e].match(/[a-z]/)){o?(s+=a[e],s+=`${a[e-2]}-${a[e]}`.toUpperCase(),o=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(s+=a[e],o=!0):s+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){s+=`[${a[e]}${a[e].toUpperCase()}]`;continue}}if(r.m){if("^"===a[e]){s+=`(^|(?<=[\r
]))`;continue}if("$"===a[e]){s+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===a[e]){s+=i?`${a[e]}\r
`:`[${a[e]}\r
]`;continue}s+=a[e],"\\"===a[e]?n=!0:i&&"]"===a[e]?i=!1:i||"["!==a[e]||(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function ad(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===w.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:av(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:av(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===w.ZodString&&e.keyType._def.checks?.length){let{type:a,...s}=an(e.keyType._def,t);return{...r,propertyNames:s}}if(e.keyType?._def.typeName===w.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===w.ZodBranded&&e.keyType._def.type._def.typeName===w.ZodString&&e.keyType._def.type._def.checks?.length){let{type:a,...s}=ae(e.keyType._def,t);return{...r,propertyNames:s}}return r}let ap={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},am=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>av(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},ah=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return av(e.innerType._def,t);let r=av(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},af=(e,t)=>{if("input"===t.pipeStrategy)return av(e.in._def,t);if("output"===t.pipeStrategy)return av(e.out._def,t);let r=av(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=av(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(e=>void 0!==e)}},ag=(e,t)=>av(e.innerType._def,t),ay=(e,t,r)=>{switch(t){case w.ZodString:return an(e,r);case w.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"int":r.type="integer",r7(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?r8(r,"minimum",a.value,a.message,t):r8(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),r8(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?r8(r,"maximum",a.value,a.message,t):r8(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),r8(r,"maximum",a.value,a.message,t));break;case"multipleOf":r8(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case w.ZodObject:return function(e,t){let r="openAi"===t.target,a={type:"object",properties:{}},s=[],n=e.shape();for(let e in n){let i=n[e];if(void 0===i||void 0===i._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(i);o&&r&&(i instanceof t7&&(i=i._def.innerType),i.isNullable()||(i=i.nullable()),o=!1);let l=av(i._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(a.properties[e]=l,o||s.push(e))}s.length&&(a.required=s);let i=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return av(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==i&&(a.additionalProperties=i),a}(e,r);case w.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?r8(r,"minimum",a.value,a.message,t):r8(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),r8(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?r8(r,"maximum",a.value,a.message,t):r8(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),r8(r,"maximum",a.value,a.message,t));break;case"multipleOf":r8(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case w.ZodBoolean:return{type:"boolean"};case w.ZodDate:return function e(t,r,a){let s=a??r.dateStrategy;if(Array.isArray(s))return{anyOf:s.map((a,s)=>e(t,r,a))};switch(s){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return ar(t,r)}}(e,r);case w.ZodUndefined:return{not:{}};case w.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case w.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==w.ZodAny&&(r.items=av(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&r8(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&r8(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(r8(r,"minItems",e.exactLength.value,e.exactLength.message,t),r8(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case w.ZodUnion:case w.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return am(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in ap&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=ap[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return am(e,t)}(e,r);case w.ZodIntersection:return function(e,t){let r=[av(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),av(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,s=[];return r.forEach(e=>{if(aa(e))s.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else a=void 0;s.push(t)}}),s.length?{allOf:s,...a}:void 0}(e,r);case w.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>av(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:av(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>av(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case w.ZodRecord:return ad(e,r);case w.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case w.ZodEnum:return{type:"string",enum:Array.from(e.values)};case w.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),a=Array.from(new Set(r.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case w.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:ap[e.innerType._def.typeName],nullable:!0}:{type:[ap[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=av(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=av(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case w.ZodOptional:return ah(e,r);case w.ZodMap:return function(e,t){return"record"===t.mapStrategy?ad(e,t):{type:"array",maxItems:125,items:{type:"array",items:[av(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},av(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case w.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:av(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&r8(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&r8(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case w.ZodLazy:return()=>e.getter()._def;case w.ZodPromise:return av(e.type._def,r);case w.ZodNaN:case w.ZodNever:return{not:{}};case w.ZodEffects:return function(e,t){return"input"===t.effectStrategy?av(e.schema._def,t):{}}(e,r);case w.ZodAny:case w.ZodUnknown:return{};case w.ZodDefault:return function(e,t){return{...av(e.innerType._def,t),default:e.defaultValue()}}(e,r);case w.ZodBranded:return ae(e,r);case w.ZodReadonly:return ag(e,r);case w.ZodCatch:return at(e,r);case w.ZodPipeline:return af(e,r);case w.ZodFunction:case w.ZodVoid:case w.ZodSymbol:default:return}};function av(e,t,r=!1){let a=t.seen.get(e);if(t.override){let s=t.override?.(e,t,a,r);if(s!==r2)return s}if(a&&!r){let e=a_(a,t);if(void 0!==e)return e}let s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);let n=ay(e,e.typeName,t),i="function"==typeof n?av(n(),t):n;if(i&&ax(e,t,i),t.postProcess){let r=t.postProcess(i,e,t);return s.jsonSchema=i,r}return s.jsonSchema=i,i}let a_=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:ab(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},ab=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},ax=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),aw=(e,t)=>{let r=r3(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:av(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,s="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,n=av(e._def,void 0===s?r:{...r,currentPath:[...r.basePath,r.definitionPath,s]},!1)??{},i="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==i&&(n.title=i);let o=void 0===s?a?{...n,[r.definitionPath]:a}:n:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,s].join("/"),[r.definitionPath]:{...a,[s]:n}};return"jsonSchema7"===r.target?o.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};var ak={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},aT={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},aS={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},aI={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},aE={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},aA=[ak,aT,aS,aI,aE];ak.code,aT.code,aS.code,aI.code,aE.code,ak.name,ak.code,aT.name,aT.code,aS.name,aS.code,aI.name,aI.code,aE.name,aE.code,aA.map(e=>e.code);var aj=[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!=typeof e||!("messageId"in e)||"string"!=typeof e.messageId)throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!=typeof e)throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!=typeof e)throw Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data)throw Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(null==e||"object"!=typeof e||!("signature"in e)||"string"!=typeof e.signature)throw Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},{code:"k",name:"file",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data||!("mimeType"in e)||"string"!=typeof e.mimeType)throw Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}}],aN=Object.fromEntries(aj.map(e=>[e.code,e]));Object.fromEntries(aj.map(e=>[e.name,e.code]));var aC=aj.map(e=>e.code),aR=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!aC.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let a=JSON.parse(e.slice(t+1));return aN[r].parse(a)};function aO(e,t){let r=aj.find(t=>t.name===e);if(!r)throw Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}var aP=Symbol.for("vercel.ai.schema");function aM(e){return"object"==typeof e&&null!==e&&aP in e&&!0===e[aP]&&"jsonSchema"in e&&"validate"in e?e:function(e,{validate:t}={}){return{[aP]:!0,_type:void 0,[ez]:!0,jsonSchema:e,validate:t}}(aw(e,{$refStrategy:"none",target:"jsonSchema7"}),{validate:t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var aZ=Object.defineProperty,a$=(e,t)=>{for(var r in t)aZ(e,r,{get:t[r],enumerable:!0})};function aD(e,{contentType:t,dataStreamVersion:r}){let a=new Headers(null!=e?e:{});return a.has("Content-Type")||a.set("Content-Type",t),void 0!==r&&a.set("X-Vercel-AI-Data-Stream",r),a}function aF(e,{contentType:t,dataStreamVersion:r}){let a={};if(null!=e)for(let[t,r]of Object.entries(e))a[t]=r;return null==a["Content-Type"]&&(a["Content-Type"]=t),void 0!==r&&(a["X-Vercel-AI-Data-Stream"]=r),a}function aq({response:e,status:t,statusText:r,headers:a,stream:s}){e.writeHead(null!=t?t:200,r,a);let n=s.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await n.read();if(t)break;e.write(r)}}catch(e){throw e}finally{e.end()}})()}var aL="AI_InvalidArgumentError",aU=`vercel.ai.error.${aL}`,az=Symbol.for(aU),aB=class extends J{constructor({parameter:e,value:t,message:r}){super({name:aL,message:`Invalid argument for parameter ${e}: ${r}`}),this[k]=!0,this.parameter=e,this.value=t}static isInstance(e){return J.hasMarker(e,aU)}};k=az;var aV="AI_RetryError",aJ=`vercel.ai.error.${aV}`,aK=Symbol.for(aJ),aW=class extends J{constructor({message:e,reason:t,errors:r}){super({name:aV,message:e}),this[T]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return J.hasMarker(e,aJ)}};T=aK;var aY=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>aG(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function aG(e,{maxRetries:t,delayInMs:r,backoffFactor:a},s=[]){try{return await e()}catch(l){if(eU(l)||0===t)throw l;let n=null==l?"unknown error":"string"==typeof l?l:l instanceof Error?l.message:JSON.stringify(l),i=[...s,l],o=i.length;if(o>t)throw new aW({message:`Failed after ${o} attempts. Last error: ${n}`,reason:"maxRetriesExceeded",errors:i});if(l instanceof Error&&G.isInstance(l)&&!0===l.isRetryable&&o<=t)return await eD(r),aG(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},i);if(1===o)throw l;throw new aW({message:`Failed after ${o} attempts with non-retryable error: '${n}'`,reason:"errorNotRetryable",errors:i})}}function aH({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}var aX={startSpan:()=>aQ,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(aQ):"function"==typeof r?r(aQ):"function"==typeof a?a(aQ):void 0},aQ={spanContext:()=>a0,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},a0={traceId:"",spanId:"",traceFlags:0};function a1({name:e,tracer:t,attributes:r,fn:a,endWhenDone:s=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return s&&e.end(),t}catch(t){try{t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:r9.s.ERROR,message:t.message})):e.setStatus({code:r9.s.ERROR})}finally{e.end()}throw t}})}function a4({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(void 0===a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let s=a.input();return void 0===s?t:{...t,[r]:s}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let s=a.output();return void 0===s?t:{...t,[r]:s}}return{...t,[r]:a}},{})}Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var a9=class{constructor({data:e,mimeType:t}){let r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mimeType=t}get base64(){return null==this.base64Data&&(this.base64Data=e0(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=eQ(this.base64Data)),this.uint8ArrayData}},a2=class extends a9{constructor(e){super(e),this.type="file"}},a6=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],a5=e=>{let t="string"==typeof e?eQ(e):e,r=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(r+10)},a3="AI_NoObjectGeneratedError",a7=`vercel.ai.error.${a3}`,a8=Symbol.for(a7),se=class extends J{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:s,finishReason:n}){super({name:a3,message:e,cause:t}),this[I]=!0,this.text=r,this.response=a,this.usage=s,this.finishReason=n}static isInstance(e){return J.hasMarker(e,a7)}};I=a8;var st="AI_DownloadError",sr=`vercel.ai.error.${st}`,sa=Symbol.for(sr),ss=class extends J{constructor({url:e,statusCode:t,statusText:r,cause:a,message:s=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:st,message:s,cause:a}),this[E]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return J.hasMarker(e,sr)}};async function sn({url:e}){var t;let r=e.toString();try{let e=await fetch(r);if(!e.ok)throw new ss({url:r,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(ss.isInstance(e))throw e;throw new ss({url:r,cause:e})}}E=sa;var si="AI_InvalidDataContentError",so=`vercel.ai.error.${si}`,sl=Symbol.for(so),su=class extends J{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:si,message:r,cause:t}),this[A]=!0,this.content=e}static isInstance(e){return J.hasMarker(e,so)}};A=sl;var sc=rB.union([rB.string(),rB.instanceof(Uint8Array),rB.instanceof(ArrayBuffer),rB.custom(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function sd(e){return"string"==typeof e?e:e instanceof ArrayBuffer?e0(new Uint8Array(e)):e0(e)}function sp(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return eQ(e)}catch(t){throw new su({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new su({content:e})}var sm="AI_InvalidMessageRoleError",sh=`vercel.ai.error.${sm}`,sf=Symbol.for(sh),sg=class extends J{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:sm,message:t}),this[j]=!0,this.role=e}static isInstance(e){return J.hasMarker(e,sh)}};async function sy({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:a=sn}){let s=await sv(e.messages,a,t,r);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function(e,t){var r,a,s,n,i,o;let l=e.role;switch(l){case"system":return{role:"system",content:e.content,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerMetadata:null!=(a=e.providerOptions)?a:e.experimental_providerMetadata};return{role:"user",content:e.content.map(e=>(function(e,t){var r,a,s,n;let i,o,l;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};let u=e.mimeType,c=e.type;switch(c){case"image":i=e.image;break;case"file":i=e.data;break;default:throw Error(`Unsupported part type: ${c}`)}try{o="string"==typeof i?new URL(i):i}catch(e){o=i}if(o instanceof URL){if("data:"===o.protocol){let{mimeType:e,base64Content:t}=function(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}(o.toString());if(null==e||null==t)throw Error(`Invalid data URL format in part ${c}`);u=e,l=sp(t)}else{let e=t[o.toString()];e?(l=e.data,null!=u||(u=e.mimeType)):l=o}}else l=sp(o);switch(c){case"image":return l instanceof Uint8Array&&(u=null!=(a=function({data:e,signatures:t}){let r="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?a5(e):e;for(let e of t)if("string"==typeof r?r.startsWith(e.base64Prefix):r.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>r[t]===e))return e.mimeType}({data:l,signatures:a6}))?a:u),{type:"image",image:l,mimeType:u,providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};case"file":if(null==u)throw Error("Mime type is missing for file part");return{type:"file",data:l instanceof Uint8Array?sd(l):l,filename:e.filename,mimeType:u,providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{var t;let r=null!=(t=e.providerOptions)?t:e.experimental_providerMetadata;switch(e.type){case"file":return{type:"file",data:e.data instanceof URL?e.data:sd(e.data),filename:e.filename,mimeType:e.mimeType,providerMetadata:r};case"reasoning":return{type:"reasoning",text:e.text,signature:e.signature,providerMetadata:r};case"redacted-reasoning":return{type:"redacted-reasoning",data:e.data,providerMetadata:r};case"text":return{type:"text",text:e.text,providerMetadata:r};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,args:e.args,providerMetadata:r}}}),providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>{var t;return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:null!=(t=e.providerOptions)?t:e.experimental_providerMetadata}}),providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};default:throw new sg({role:l})}})(e,s))]}async function sv(e,t,r,a){let s=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).filter(e=>!("image"===e.type&&!0===r)).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL).filter(e=>!a(e));return Object.fromEntries((await Promise.all(s.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}function s_(e){var t,r,a;let s=[];for(let n of e){let e;try{e=new URL(n.url)}catch(e){throw Error(`Invalid URL: ${n.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=n.contentType)?void 0:t.startsWith("image/"))s.push({type:"image",image:e});else{if(!n.contentType)throw Error("If the attachment is not an image, it must specify a content type");s.push({type:"file",data:e,mimeType:n.contentType})}break;case"data:":{let e,t,i;try{[e,t]=n.url.split(","),i=e.split(";")[0].split(":")[1]}catch(e){throw Error(`Error processing data URL: ${n.url}`)}if(null==i||null==t)throw Error(`Invalid data URL format: ${n.url}`);if(null==(r=n.contentType)?void 0:r.startsWith("image/"))s.push({type:"image",image:sp(t)});else if(null==(a=n.contentType)?void 0:a.startsWith("text/"))s.push({type:"text",text:function(e){try{return new TextDecoder().decode(e)}catch(e){throw Error("Error decoding Uint8Array to text")}}(sp(t))});else{if(!n.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");s.push({type:"file",data:t,mimeType:n.contentType})}break}default:throw Error(`Unsupported URL protocol: ${e.protocol}`)}}return s}j=sf;var sb="AI_MessageConversionError",sx=`vercel.ai.error.${sb}`,sw=Symbol.for(sx),sk=class extends J{constructor({originalMessage:e,message:t}){super({name:sb,message:t}),this[N]=!0,this.originalMessage=e}static isInstance(e){return J.hasMarker(e,sx)}};function sT(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}N=sw;var sS=rB.lazy(()=>rB.union([rB.null(),rB.string(),rB.number(),rB.boolean(),rB.record(rB.string(),sS),rB.array(sS)])),sI=rB.record(rB.string(),rB.record(rB.string(),sS)),sE=rB.array(rB.union([rB.object({type:rB.literal("text"),text:rB.string()}),rB.object({type:rB.literal("image"),data:rB.string(),mimeType:rB.string().optional()})])),sA=rB.object({type:rB.literal("text"),text:rB.string(),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),sj=rB.object({type:rB.literal("image"),image:rB.union([sc,rB.instanceof(URL)]),mimeType:rB.string().optional(),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),sN=rB.object({type:rB.literal("file"),data:rB.union([sc,rB.instanceof(URL)]),filename:rB.string().optional(),mimeType:rB.string(),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),sC=rB.object({type:rB.literal("reasoning"),text:rB.string(),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),sR=rB.object({type:rB.literal("redacted-reasoning"),data:rB.string(),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),sO=rB.object({type:rB.literal("tool-call"),toolCallId:rB.string(),toolName:rB.string(),args:rB.unknown(),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),sP=rB.object({type:rB.literal("tool-result"),toolCallId:rB.string(),toolName:rB.string(),result:rB.unknown(),content:sE.optional(),isError:rB.boolean().optional(),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),sM=rB.object({role:rB.literal("system"),content:rB.string(),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),sZ=rB.object({role:rB.literal("user"),content:rB.union([rB.string(),rB.array(rB.union([sA,sj,sN]))]),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),s$=rB.object({role:rB.literal("assistant"),content:rB.union([rB.string(),rB.array(rB.union([sA,sN,sC,sR,sO]))]),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),sD=rB.object({role:rB.literal("tool"),content:rB.array(sP),providerOptions:sI.optional(),experimental_providerMetadata:sI.optional()}),sF=rB.union([sM,sZ,s$,sD]);function sq(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let e=t.getReader();return{async next(){let{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}},t}eq({prefix:"aiobj",size:24});var sL=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this.promise}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&(null==(t=this._reject)||t.call(this,e))}};function sU(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}eq({prefix:"aiobj",size:24});var sz="AI_NoOutputSpecifiedError",sB=`vercel.ai.error.${sz}`,sV=Symbol.for(sB),sJ=class extends J{constructor({message:e="No output specified."}={}){super({name:sz,message:e}),this[C]=!0}static isInstance(e){return J.hasMarker(e,sB)}};C=sV;var sK="AI_ToolExecutionError",sW=`vercel.ai.error.${sK}`,sY=Symbol.for(sW),sG=class extends J{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:a,message:s=`Error executing tool ${t}: ${et(a)}`}){super({name:sK,message:s,cause:a}),this[R]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return J.hasMarker(e,sW)}};R=sY;var sH=/^([\s\S]*?)(\s+)(\S*)$/,sX="AI_InvalidToolArgumentsError",sQ=`vercel.ai.error.${sX}`,s0=Symbol.for(sQ),s1=class extends J{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${et(r)}`}){super({name:sX,message:a,cause:r}),this[O]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return J.hasMarker(e,sQ)}};O=s0;var s4="AI_NoSuchToolError",s9=`vercel.ai.error.${s4}`,s2=Symbol.for(s9),s6=class extends J{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:s4,message:r}),this[P]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return J.hasMarker(e,s9)}};P=s2;var s5="AI_ToolCallRepairError",s3=`vercel.ai.error.${s5}`,s7=Symbol.for(s3),s8=class extends J{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${et(e)}`}){super({name:s5,message:r,cause:e}),this[M]=!0,this.originalError=t}static isInstance(e){return J.hasMarker(e,s3)}};async function ne({toolCall:e,tools:t,repairToolCall:r,system:a,messages:s}){if(null==t)throw new s6({toolName:e.toolName});try{return await nt({toolCall:e,tools:t})}catch(i){if(null==r||!(s6.isInstance(i)||s1.isInstance(i)))throw i;let n=null;try{n=await r({toolCall:e,tools:t,parameterSchema:({toolName:e})=>aM(t[e].parameters).jsonSchema,system:a,messages:s,error:i})}catch(e){throw new s8({cause:e,originalError:i})}if(null==n)throw i;return await nt({toolCall:n,tools:t})}}async function nt({toolCall:e,tools:t}){let r=e.toolName,a=t[r];if(null==a)throw new s6({toolName:e.toolName,availableTools:Object.keys(t)});let s=aM(a.parameters),n=""===e.args.trim()?eB({value:{},schema:s}):eV({text:e.args,schema:s});if(!1===n.success)throw new s1({toolName:r,toolArgs:e.args,cause:n.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:n.value}}function nr({text:e="",files:t,reasoning:r,tools:a,toolCalls:s,toolResults:n,messageId:i,generateMessageId:o}){let l=[],u=[];return r.length>0&&u.push(...r.map(e=>"text"===e.type?{...e,type:"reasoning"}:{...e,type:"redacted-reasoning"})),t.length>0&&u.push(...t.map(e=>({type:"file",data:e.base64,mimeType:e.mimeType}))),e.length>0&&u.push({type:"text",text:e}),s.length>0&&u.push(...s),u.length>0&&l.push({role:"assistant",content:u,id:i}),n.length>0&&l.push({role:"tool",id:o(),content:n.map(e=>{let t=a[e.toolName];return(null==t?void 0:t.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:t.experimental_toToolResultContent(e.result),experimental_content:t.experimental_toToolResultContent(e.result)}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}})}),l}M=s7,eq({prefix:"aitxt",size:24}),eq({prefix:"msg",size:24}),a$({},{object:()=>nd,text:()=>nc});var na="AI_InvalidStreamPartError",ns=`vercel.ai.error.${na}`,nn=Symbol.for(ns),ni=class extends J{constructor({chunk:e,message:t}){super({name:na,message:t}),this[Z]=!0,this.chunk=e}static isInstance(e){return J.hasMarker(e,ns)}};Z=nn;var no="vercel.ai.error.AI_MCPClientError",nl=Symbol.for(no),nu=class extends J{constructor({name:e="MCPClientError",message:t,cause:r}){super({name:e,message:t,cause:r}),this[$]=!0}static isInstance(e){return J.hasMarker(e,no)}};$=nl;var nc=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),nd=({schema:e})=>{let t=aM(e);return{type:"object",responseFormat:({model:e})=>({type:"json",schema:e.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:e,model:r})=>r.supportsStructuredOutputs?e:function({prompt:e,schema:t,schemaPrefix:r=null!=t?"JSON schema:":void 0,schemaSuffix:a=null!=t?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[null!=e&&e.length>0?e:void 0,null!=e&&e.length>0?"":void 0,r,null!=t?JSON.stringify(t):void 0,a].filter(e=>null!=e).join("\n")}({prompt:e,schema:t.jsonSchema}),parsePartial({text:e}){let t=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=eV({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=eV({text:function(e){let t=["ROOT"],r=-1,a=null;function s(e,s,n){switch(e){case'"':r=s,t.pop(),t.push(n),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=s,a=s,t.pop(),t.push(n),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=s,t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"{":r=s,t.pop(),t.push(n),t.push("INSIDE_OBJECT_START");break;case"[":r=s,t.pop(),t.push(n),t.push("INSIDE_ARRAY_START")}}function n(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function i(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let o=0;o<e.length;o++){let l=e[o];switch(t[t.length-1]){case"ROOT":s(l,o,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=o,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":s(l,o,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(l,o);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=o;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=o}break;case"INSIDE_ARRAY_START":"]"===l?(r=o,t.pop()):(r=o,s(l,o,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=o,t.pop();break;default:r=o}break;case"INSIDE_ARRAY_AFTER_COMMA":s(l,o,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=o;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=o;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,o);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,o);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o);break;default:t.pop()}break;case"INSIDE_LITERAL":{let s=e.substring(a,o+1);"false".startsWith(s)||"true".startsWith(s)||"null".startsWith(s)?r=o:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?n(l,o):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o))}}}let o=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let t=e.substring(a,e.length);"true".startsWith(t)?o+="true".slice(t.length):"false".startsWith(t)?o+="false".slice(t.length):"null".startsWith(t)&&(o+="null".slice(t.length))}}return o}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},parseOutput({text:e},r){let a=eV({text:e});if(!a.success)throw new se({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let s=eB({value:a.value,schema:t});if(!s.success)throw new se({message:"No object generated: response did not match schema.",cause:s.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return s.value}}};async function np({stream:e,onError:t}){let r=e.getReader();try{for(;;){let{done:e}=await r.read();if(e)break}}catch(e){null==t||t(e)}finally{r.releaseLock()}}function nm(e,t){let r,a;let s=e.getReader(),n=t.getReader(),i=!1,o=!1;async function l(e){try{null==r&&(r=s.read());let t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==a&&(a=n.read());let t=await a;a=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(i){await u(e);return}if(o){await l(e);return}null==r&&(r=s.read()),null==a&&(a=n.read());let{result:t,reader:c}=await Promise.race([r.then(e=>({result:e,reader:s})),a.then(e=>({result:e,reader:n}))]);t.done||e.enqueue(t.value),c===s?(r=void 0,t.done&&(await u(e),i=!0)):(a=void 0,t.done&&(o=!0,await l(e)))}catch(t){e.error(t)}},cancel(){s.cancel(),n.cancel()}})}var nh=eq({prefix:"aitxt",size:24}),nf=eq({prefix:"msg",size:24}),ng=class{constructor({model:e,telemetry:t,headers:r,settings:a,maxRetries:s,abortSignal:n,system:i,prompt:o,messages:l,tools:u,toolChoice:c,toolCallStreaming:d,transforms:p,activeTools:m,repairToolCall:h,maxSteps:f,output:g,continueSteps:y,providerOptions:v,now:_,currentDate:b,generateId:x,generateMessageId:w,onChunk:k,onError:T,onFinish:S,onStepFinish:I}){var E;let A,j,N,C;if(this.warningsPromise=new sL,this.usagePromise=new sL,this.finishReasonPromise=new sL,this.providerMetadataPromise=new sL,this.textPromise=new sL,this.reasoningPromise=new sL,this.reasoningDetailsPromise=new sL,this.sourcesPromise=new sL,this.filesPromise=new sL,this.toolCallsPromise=new sL,this.toolResultsPromise=new sL,this.requestPromise=new sL,this.responsePromise=new sL,this.stepsPromise=new sL,f<1)throw new aB({parameter:"maxSteps",value:f,message:"maxSteps must be at least 1"});this.output=g;let R="",O="",P="",M=[],Z=[],$=[],D=[],F={id:x(),timestamp:b(),modelId:e.modelId,messages:[]},q=[],L=[],U="initial",z=[],B=new TransformStream({async transform(e,t){t.enqueue(e);let{part:r}=e;if(("text-delta"===r.type||"reasoning"===r.type||"source"===r.type||"tool-call"===r.type||"tool-result"===r.type||"tool-call-streaming-start"===r.type||"tool-call-delta"===r.type)&&await (null==k?void 0:k({chunk:r})),"error"===r.type&&await (null==T?void 0:T({error:r.error})),"text-delta"===r.type&&(R+=r.textDelta,O+=r.textDelta,P+=r.textDelta),"reasoning"===r.type&&(null==j?(j={type:"text",text:r.textDelta},M.push(j)):j.text+=r.textDelta),"reasoning-signature"===r.type){if(null==j)throw new J({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});j.signature=r.signature,j=void 0}if("redacted-reasoning"===r.type&&M.push({type:"redacted",data:r.data}),"file"===r.type&&Z.push(r),"source"===r.type&&(D.push(r.source),$.push(r.source)),"tool-call"===r.type&&q.push(r),"tool-result"===r.type&&L.push(r),"step-finish"===r.type){let e=nr({text:O,files:Z,reasoning:M,tools:null!=u?u:{},toolCalls:q,toolResults:L,messageId:r.messageId,generateMessageId:w}),t=z.length,a="done";t+1<f&&(y&&"length"===r.finishReason&&0===q.length?a="continue":q.length>0&&L.length===q.length&&(a="tool-result"));let s={stepType:U,text:R,reasoning:function(e){let t=e.filter(e=>"text"===e.type).map(e=>e.text).join("");return t.length>0?t:void 0}(M),reasoningDetails:M,files:Z,sources:$,toolCalls:q,toolResults:L,finishReason:r.finishReason,usage:r.usage,warnings:r.warnings,logprobs:r.logprobs,request:r.request,response:{...r.response,messages:[...F.messages,...e]},providerMetadata:r.experimental_providerMetadata,experimental_providerMetadata:r.experimental_providerMetadata,isContinued:r.isContinued};await (null==I?void 0:I(s)),z.push(s),q=[],L=[],R="",$=[],M=[],Z=[],j=void 0,"done"!==a&&(U=a),"continue"!==a&&(F.messages.push(...e),O="")}"finish"===r.type&&(F.id=r.response.id,F.timestamp=r.response.timestamp,F.modelId=r.response.modelId,F.headers=r.response.headers,C=r.usage,N=r.finishReason)},async flush(e){var r;try{if(0===z.length)return;let e=z[z.length-1];Q.warningsPromise.resolve(e.warnings),Q.requestPromise.resolve(e.request),Q.responsePromise.resolve(e.response),Q.toolCallsPromise.resolve(e.toolCalls),Q.toolResultsPromise.resolve(e.toolResults),Q.providerMetadataPromise.resolve(e.experimental_providerMetadata),Q.reasoningPromise.resolve(e.reasoning),Q.reasoningDetailsPromise.resolve(e.reasoningDetails);let a=null!=N?N:"unknown",s=null!=C?C:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};Q.finishReasonPromise.resolve(a),Q.usagePromise.resolve(s),Q.textPromise.resolve(P),Q.sourcesPromise.resolve(D),Q.filesPromise.resolve(e.files),Q.stepsPromise.resolve(z),await (null==S?void 0:S({finishReason:a,logprobs:void 0,usage:s,text:P,reasoning:e.reasoning,reasoningDetails:e.reasoningDetails,files:e.files,sources:e.sources,toolCalls:e.toolCalls,toolResults:e.toolResults,request:null!=(r=e.request)?r:{},response:e.response,warnings:e.warnings,providerMetadata:e.providerMetadata,experimental_providerMetadata:e.experimental_providerMetadata,steps:z})),A.setAttributes(a4({telemetry:t,attributes:{"ai.response.finishReason":a,"ai.response.text":{output:()=>P},"ai.response.toolCalls":{output:()=>{var t;return(null==(t=e.toolCalls)?void 0:t.length)?JSON.stringify(e.toolCalls):void 0}},"ai.usage.promptTokens":s.promptTokens,"ai.usage.completionTokens":s.completionTokens}}))}catch(t){e.error(t)}finally{A.end()}}}),V=function(){let e=[],t=null,r=!1,a=sU(),s=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return a=sU(),await a.promise,s();try{let{value:a,done:n}=await e[0].read();n?(e.shift(),e.length>0?await s():r&&(null==t||t.close())):null==t||t.enqueue(a)}catch(a){null==t||t.error(a),e.shift(),r&&0===e.length&&(null==t||t.close())}};return{stream:new ReadableStream({start(e){t=e},pull:s,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),0===e.length&&(null==t||t.close())},terminate:()=>{r=!0,a.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()}}}();this.addStream=V.addStream,this.closeStream=V.close;let K=V.stream;for(let e of p)K=K.pipeThrough(e({tools:u,stopStream(){V.terminate()}}));this.baseStream=K.pipeThrough(function(e){if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let t="",r="",a="";function s({controller:e,partialOutput:t}){e.enqueue({part:{type:"text-delta",textDelta:r},partialOutput:t}),r=""}return new TransformStream({transform(n,i){if("step-finish"===n.type&&s({controller:i}),"text-delta"!==n.type){i.enqueue({part:n,partialOutput:void 0});return}t+=n.textDelta,r+=n.textDelta;let o=e.parsePartial({text:t});if(null!=o){let e=JSON.stringify(o.partial);e!==a&&(s({controller:i,partialOutput:o.partial}),a=e)}},flush(e){r.length>0&&s({controller:e})}})}(g)).pipeThrough(B);let{maxRetries:W,retry:Y}=function({maxRetries:e}){if(null!=e){if(!Number.isInteger(e))throw new aB({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new aB({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=null!=e?e:2;return{maxRetries:t,retry:aY({maxRetries:t})}}({maxRetries:s}),G=function({isEnabled:e=!1,tracer:t}={}){return e?t||r4.u.getTracer("ai"):aX}(t),H=function({model:e,settings:t,telemetry:r,headers:a}){var s;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(s=null==r?void 0:r.metadata)?s:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}({model:e,telemetry:t,headers:r,settings:{...a,maxRetries:W}}),X=function({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new eu({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new eu({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new eu({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new eu({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){let r=function(e){if(!Array.isArray(e))return"other";if(0===e.length)return"messages";let t=e.map(sT);return t.some(e=>"has-ui-specific-parts"===e)?"ui-messages":t.every(e=>"has-core-specific-parts"===e||"message"===e)?"messages":"other"}(e.messages);if("other"===r)throw new eu({prompt:e,message:"messages must be an array of CoreMessage or UIMessage"});let a="ui-messages"===r?function(e,t){var r,a;let s=null!=(r=null==t?void 0:t.tools)?r:{},n=[];for(let t=0;t<e.length;t++){let r=e[t],i=t===e.length-1,{role:o,content:l,experimental_attachments:u}=r;switch(o){case"system":n.push({role:"system",content:l});break;case"user":if(null==r.parts)n.push({role:"user",content:u?[{type:"text",text:l},...s_(u)]:l});else{let e=r.parts.filter(e=>"text"===e.type).map(e=>({type:"text",text:e.text}));n.push({role:"user",content:u?[...e,...s_(u)]:e})}break;case"assistant":{if(null!=r.parts){let e=function(){let e=[];for(let t of o)switch(t.type){case"file":case"text":e.push(t);break;case"reasoning":for(let r of t.details)switch(r.type){case"text":e.push({type:"reasoning",text:r.text,signature:r.signature});break;case"redacted":e.push({type:"redacted-reasoning",data:r.data})}break;case"tool-invocation":e.push({type:"tool-call",toolCallId:t.toolInvocation.toolCallId,toolName:t.toolInvocation.toolName,args:t.toolInvocation.args});break;default:throw Error(`Unsupported part: ${t}`)}n.push({role:"assistant",content:e});let a=o.filter(e=>"tool-invocation"===e.type).map(e=>e.toolInvocation);a.length>0&&n.push({role:"tool",content:a.map(e=>{if(!("result"in e))throw new sk({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:n}=e,i=s[a];return(null==i?void 0:i.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:i.experimental_toToolResultContent(n),experimental_content:i.experimental_toToolResultContent(n)}:{type:"tool-result",toolCallId:t,toolName:a,result:n}})}),o=[],i=!1,t++},t=0,i=!1,o=[];for(let s of r.parts)switch(s.type){case"text":i&&e(),o.push(s);break;case"file":case"reasoning":o.push(s);break;case"tool-invocation":(null!=(a=s.toolInvocation.step)?a:0)!==t&&e(),o.push(s),i=!0}e();break}let e=r.toolInvocations;if(null==e||0===e.length){n.push({role:"assistant",content:l});break}let t=e.reduce((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)},0);for(let a=0;a<=t;a++){let t=e.filter(e=>{var t;return(null!=(t=e.step)?t:0)===a});0!==t.length&&(n.push({role:"assistant",content:[...i&&l&&0===a?[{type:"text",text:l}]:[],...t.map(({toolCallId:e,toolName:t,args:r})=>({type:"tool-call",toolCallId:e,toolName:t,args:r}))]}),n.push({role:"tool",content:t.map(e=>{if(!("result"in e))throw new sk({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:n}=e,i=s[a];return(null==i?void 0:i.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:i.experimental_toToolResultContent(n),experimental_content:i.experimental_toToolResultContent(n)}:{type:"tool-result",toolCallId:t,toolName:a,result:n}})}))}l&&!i&&n.push({role:"assistant",content:l});break}case"data":break;default:throw new sk({originalMessage:r,message:`Unsupported role: ${o}`})}}return n}(e.messages,{tools:t}):e.messages;if(0===a.length)throw new eu({prompt:e,message:"messages must not be empty"});let s=eB({value:a,schema:rB.array(sF)});if(!s.success)throw new eu({prompt:e,message:"messages must be an array of CoreMessage or UIMessage",cause:s.error});return{type:"messages",messages:a,system:e.system}}throw Error("unreachable")}({prompt:{system:null!=(E=null==g?void 0:g.injectIntoSystemPrompt({system:i,model:e}))?E:i,prompt:o,messages:l},tools:u}),Q=this;a1({name:"ai.streamText",attributes:a4({telemetry:t,attributes:{...aH({operationId:"ai.streamText",telemetry:t}),...H,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:o,messages:l})},"ai.settings.maxSteps":f}}),tracer:G,endWhenDone:!1,fn:async s=>{async function o({currentStep:s,responseMessages:l,usage:p,stepType:k,previousStepText:T,hasLeadingWhitespace:S,messageId:I}){var E;let A,j,N;let C=0===l.length?X.type:"messages",R=[...X.messages,...l],O=await sy({prompt:{type:C,system:X.system,messages:R},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(E=e.supportsUrl)?void 0:E.bind(e)}),P={type:"regular",...function({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"function":return{type:"function",name:e,description:t.description,parameters:aM(t.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:u,toolChoice:c,activeTools:m})},{result:{stream:M,warnings:Z,rawResponse:$,request:D},doStreamSpan:F,startTimestampMs:q}=await Y(()=>a1({name:"ai.streamText.doStream",attributes:a4({telemetry:t,attributes:{...aH({operationId:"ai.streamText.doStream",telemetry:t}),...H,"ai.prompt.format":{input:()=>C},"ai.prompt.messages":{input:()=>JSON.stringify(O)},"ai.prompt.tools":{input:()=>{var e;return null==(e=P.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=P.toolChoice?JSON.stringify(P.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":a.frequencyPenalty,"gen_ai.request.max_tokens":a.maxTokens,"gen_ai.request.presence_penalty":a.presencePenalty,"gen_ai.request.stop_sequences":a.stopSequences,"gen_ai.request.temperature":a.temperature,"gen_ai.request.top_k":a.topK,"gen_ai.request.top_p":a.topP}}),tracer:G,endWhenDone:!1,fn:async t=>({startTimestampMs:_(),doStreamSpan:t,result:await e.doStream({mode:P,...function({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:s,frequencyPenalty:n,stopSequences:i,seed:o}){if(null!=e){if(!Number.isInteger(e))throw new aB({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new aB({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new aB({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new aB({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new aB({parameter:"topK",value:a,message:"topK must be a number"});if(null!=s&&"number"!=typeof s)throw new aB({parameter:"presencePenalty",value:s,message:"presencePenalty must be a number"});if(null!=n&&"number"!=typeof n)throw new aB({parameter:"frequencyPenalty",value:n,message:"frequencyPenalty must be a number"});if(null!=o&&!Number.isInteger(o))throw new aB({parameter:"seed",value:o,message:"seed must be an integer"});return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:a,presencePenalty:s,frequencyPenalty:n,stopSequences:null!=i&&i.length>0?i:void 0,seed:o}}(a),inputFormat:C,responseFormat:null==g?void 0:g.responseFormat({model:e}),prompt:O,providerMetadata:v,abortSignal:n,headers:r})})})),L=function({tools:e,generatorStream:t,toolCallStreaming:r,tracer:a,telemetry:s,system:n,messages:i,abortSignal:o,repairToolCall:l}){let u,c=null,d=new ReadableStream({start(e){c=e}}),p={},m=new Set,h=!1;function f(){h&&0===m.size&&(null!=u&&c.enqueue(u),c.close())}let g=new TransformStream({async transform(t,d){let h=t.type;switch(h){case"text-delta":case"reasoning":case"reasoning-signature":case"redacted-reasoning":case"source":case"response-metadata":case"error":d.enqueue(t);break;case"file":d.enqueue(new a2({data:t.data,mimeType:t.mimeType}));break;case"tool-call-delta":r&&(p[t.toolCallId]||(d.enqueue({type:"tool-call-streaming-start",toolCallId:t.toolCallId,toolName:t.toolName}),p[t.toolCallId]=!0),d.enqueue({type:"tool-call-delta",toolCallId:t.toolCallId,toolName:t.toolName,argsTextDelta:t.argsTextDelta}));break;case"tool-call":try{let r=await ne({toolCall:t,tools:e,repairToolCall:l,system:n,messages:i});d.enqueue(r);let u=e[r.toolName];if(null!=u.execute){let e=eL();m.add(e),a1({name:"ai.toolCall",attributes:a4({telemetry:s,attributes:{...aH({operationId:"ai.toolCall",telemetry:s}),"ai.toolCall.name":r.toolName,"ai.toolCall.id":r.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(r.args)}}}),tracer:a,fn:async t=>u.execute(r.args,{toolCallId:r.toolCallId,messages:i,abortSignal:o}).then(a=>{c.enqueue({...r,type:"tool-result",result:a}),m.delete(e),f();try{t.setAttributes(a4({telemetry:s,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}},t=>{c.enqueue({type:"error",error:new sG({toolCallId:r.toolCallId,toolName:r.toolName,toolArgs:r.args,cause:t})}),m.delete(e),f()})})}}catch(e){c.enqueue({type:"error",error:e})}break;case"finish":u={type:"finish",finishReason:t.finishReason,logprobs:t.logprobs,usage:function({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}(t.usage),experimental_providerMetadata:t.providerMetadata};break;default:throw Error(`Unhandled chunk type: ${h}`)}},flush(){h=!0,f()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),d.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:u,generatorStream:M,toolCallStreaming:d,tracer:G,telemetry:t,system:i,messages:R,repairToolCall:h,abortSignal:n}),U=null!=D?D:{},z=[],B=[],V=[],J=[],K="unknown",W={promptTokens:0,completionTokens:0,totalTokens:0},ee=!0,et="",er="continue"===k?T:"",ea={id:x(),timestamp:b(),modelId:e.modelId},es="",en=!1,ei=!0,eo=!1;async function el({controller:e,chunk:t}){e.enqueue(t),et+=t.textDelta,er+=t.textDelta,en=!0,eo=t.textDelta.trimEnd()!==t.textDelta}Q.addStream(L.pipeThrough(new TransformStream({async transform(e,t){var r,a,s;if(ee){let e=_()-q;ee=!1,F.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),F.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"step-start",messageId:I,request:U,warnings:null!=Z?Z:[]})}if("text-delta"===e.type&&0===e.textDelta.length)return;let n=e.type;switch(n){case"text-delta":if(y){let r=ei&&S?e.textDelta.trimStart():e.textDelta;if(0===r.length)break;ei=!1;let a=function(e){let t=e.match(sH);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}(es+=r);null!=a&&(es=a.suffix,await el({controller:t,chunk:{type:"text-delta",textDelta:a.prefix+a.whitespace}}))}else await el({controller:t,chunk:e});break;case"reasoning":t.enqueue(e),null==N?(N={type:"text",text:e.textDelta},V.push(N)):N.text+=e.textDelta;break;case"reasoning-signature":if(t.enqueue(e),null==N)throw new ni({chunk:e,message:"reasoning-signature without reasoning"});N.signature=e.signature,N=void 0;break;case"redacted-reasoning":t.enqueue(e),V.push({type:"redacted",data:e.data});break;case"tool-call":t.enqueue(e),z.push(e);break;case"tool-result":t.enqueue(e),B.push(e);break;case"response-metadata":ea={id:null!=(r=e.id)?r:ea.id,timestamp:null!=(a=e.timestamp)?a:ea.timestamp,modelId:null!=(s=e.modelId)?s:ea.modelId};break;case"finish":{W=e.usage,K=e.finishReason,A=e.experimental_providerMetadata,j=e.logprobs;let t=_()-q;F.addEvent("ai.stream.finish"),F.setAttributes({"ai.response.msToFinish":t,"ai.response.avgCompletionTokensPerSecond":1e3*W.completionTokens/t});break}case"file":J.push(e),t.enqueue(e);break;case"source":case"tool-call-streaming-start":case"tool-call-delta":t.enqueue(e);break;case"error":t.enqueue(e),K="error";break;default:throw Error(`Unknown chunk type: ${n}`)}},async flush(e){var r;let a=z.length>0?JSON.stringify(z):void 0,n="done";s+1<f&&(y&&"length"===K&&0===z.length?n="continue":z.length>0&&B.length===z.length&&(n="tool-result")),y&&es.length>0&&("continue"!==n||"continue"===k&&!en)&&(await el({controller:e,chunk:{type:"text-delta",textDelta:es}}),es="");try{F.setAttributes(a4({telemetry:t,attributes:{"ai.response.finishReason":K,"ai.response.text":{output:()=>et},"ai.response.toolCalls":{output:()=>a},"ai.response.id":ea.id,"ai.response.model":ea.modelId,"ai.response.timestamp":ea.timestamp.toISOString(),"ai.usage.promptTokens":W.promptTokens,"ai.usage.completionTokens":W.completionTokens,"gen_ai.response.finish_reasons":[K],"gen_ai.response.id":ea.id,"gen_ai.response.model":ea.modelId,"gen_ai.usage.input_tokens":W.promptTokens,"gen_ai.usage.output_tokens":W.completionTokens}}))}catch(e){}finally{F.end()}e.enqueue({type:"step-finish",finishReason:K,usage:W,providerMetadata:A,experimental_providerMetadata:A,logprobs:j,request:U,response:{...ea,headers:null==$?void 0:$.headers},warnings:Z,isContinued:"continue"===n,messageId:I});let i=(r=W,{promptTokens:p.promptTokens+r.promptTokens,completionTokens:p.completionTokens+r.completionTokens,totalTokens:p.totalTokens+r.totalTokens});if("done"===n)e.enqueue({type:"finish",finishReason:K,usage:i,providerMetadata:A,experimental_providerMetadata:A,logprobs:j,response:{...ea,headers:null==$?void 0:$.headers}}),Q.closeStream();else{if("continue"===k){let e=l[l.length-1];"string"==typeof e.content?e.content+=et:e.content.push({text:et,type:"text"})}else l.push(...nr({text:et,files:J,reasoning:V,tools:null!=u?u:{},toolCalls:z,toolResults:B,messageId:I,generateMessageId:w}));await o({currentStep:s+1,responseMessages:l,usage:i,stepType:n,previousStepText:er,hasLeadingWhitespace:eo,messageId:"continue"===n?I:w()})}}})))}A=s,await o({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:w()})}}).catch(e=>{Q.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),Q.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get files(){return this.filesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return sq(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.textDelta)}})))}get fullStream(){return sq(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await np({stream:this.fullStream,onError:null==e?void 0:e.onError})}catch(r){null==(t=null==e?void 0:e.onError)||t.call(e,r)}}get experimental_partialOutputStream(){if(null==this.output)throw new sJ;return sq(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0,sendReasoning:r=!1,sendSources:a=!1,experimental_sendFinish:s=!0}){return this.fullStream.pipeThrough(new TransformStream({transform:async(n,i)=>{let o=n.type;switch(o){case"text-delta":i.enqueue(aO("text",n.textDelta));break;case"reasoning":r&&i.enqueue(aO("reasoning",n.textDelta));break;case"redacted-reasoning":r&&i.enqueue(aO("redacted_reasoning",{data:n.data}));break;case"reasoning-signature":r&&i.enqueue(aO("reasoning_signature",{signature:n.signature}));break;case"file":i.enqueue(aO("file",{mimeType:n.mimeType,data:n.base64}));break;case"source":a&&i.enqueue(aO("source",n.source));break;case"tool-call-streaming-start":i.enqueue(aO("tool_call_streaming_start",{toolCallId:n.toolCallId,toolName:n.toolName}));break;case"tool-call-delta":i.enqueue(aO("tool_call_delta",{toolCallId:n.toolCallId,argsTextDelta:n.argsTextDelta}));break;case"tool-call":i.enqueue(aO("tool_call",{toolCallId:n.toolCallId,toolName:n.toolName,args:n.args}));break;case"tool-result":i.enqueue(aO("tool_result",{toolCallId:n.toolCallId,result:n.result}));break;case"error":i.enqueue(aO("error",e(n.error)));break;case"step-start":i.enqueue(aO("start_step",{messageId:n.messageId}));break;case"step-finish":i.enqueue(aO("finish_step",{finishReason:n.finishReason,usage:t?{promptTokens:n.usage.promptTokens,completionTokens:n.usage.completionTokens}:void 0,isContinued:n.isContinued}));break;case"finish":s&&i.enqueue(aO("finish_message",{finishReason:n.finishReason,usage:t?{promptTokens:n.usage.promptTokens,completionTokens:n.usage.completionTokens}:void 0}));break;default:throw Error(`Unknown chunk type: ${o}`)}}}))}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:a,data:s,getErrorMessage:n,sendUsage:i,sendReasoning:o,sendSources:l,experimental_sendFinish:u}={}){aq({response:e,status:t,statusText:r,headers:aF(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:s,getErrorMessage:n,sendUsage:i,sendReasoning:o,sendSources:l,experimental_sendFinish:u})})}pipeTextStreamToResponse(e,t){aq({response:e,status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,headers:aF(null==t?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){let t=this.toDataStreamInternal({getErrorMessage:null==e?void 0:e.getErrorMessage,sendUsage:null==e?void 0:e.sendUsage,sendReasoning:null==e?void 0:e.sendReasoning,sendSources:null==e?void 0:e.sendSources,experimental_sendFinish:null==e?void 0:e.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return(null==e?void 0:e.data)?nm(null==e?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:null==t?void 0:t.sendUsage,sendReasoning:null==t?void 0:t.sendReasoning,sendSources:null==t?void 0:t.sendSources,experimental_sendFinish:null==t?void 0:t.experimental_sendFinish}))}toDataStreamResponse({headers:e,status:t,statusText:r,data:a,getErrorMessage:s,sendUsage:n,sendReasoning:i,sendSources:o,experimental_sendFinish:l}={}){return new Response(this.toDataStream({data:a,getErrorMessage:s,sendUsage:n,sendReasoning:i,sendSources:o,experimental_sendFinish:l}),{status:t,statusText:r,headers:aD(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:aD(null==e?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},ny="AI_NoSuchProviderError",nv=`vercel.ai.error.${ny}`;D=Symbol.for(nv);var n_=rB.object({name:rB.string(),version:rB.string()}).passthrough(),nb=rB.object({_meta:rB.optional(rB.object({}).passthrough())}).passthrough(),nx=rB.object({method:rB.string(),params:rB.optional(nb)}),nw=rB.object({experimental:rB.optional(rB.object({}).passthrough()),logging:rB.optional(rB.object({}).passthrough()),prompts:rB.optional(rB.object({listChanged:rB.optional(rB.boolean())}).passthrough()),resources:rB.optional(rB.object({subscribe:rB.optional(rB.boolean()),listChanged:rB.optional(rB.boolean())}).passthrough()),tools:rB.optional(rB.object({listChanged:rB.optional(rB.boolean())}).passthrough())}).passthrough(),nk=(nb.extend({protocolVersion:rB.string(),capabilities:nw,serverInfo:n_,instructions:rB.optional(rB.string())}),nb.extend({nextCursor:rB.optional(rB.string())})),nT=rB.object({name:rB.string(),description:rB.optional(rB.string()),inputSchema:rB.object({type:rB.literal("object"),properties:rB.optional(rB.object({}).passthrough())}).passthrough()}).passthrough(),nS=(nk.extend({tools:rB.array(nT)}),rB.object({type:rB.literal("text"),text:rB.string()}).passthrough()),nI=rB.object({type:rB.literal("image"),data:rB.string().base64(),mimeType:rB.string()}).passthrough(),nE=rB.object({uri:rB.string(),mimeType:rB.optional(rB.string())}).passthrough(),nA=nE.extend({text:rB.string()}),nj=nE.extend({blob:rB.string().base64()}),nN=rB.object({type:rB.literal("resource"),resource:rB.union([nA,nj])}).passthrough(),nC=(nb.extend({content:rB.array(rB.union([nS,nI,nN])),isError:rB.boolean().default(!1).optional()}).or(nb.extend({toolResult:rB.unknown()})),rB.object({jsonrpc:rB.literal("2.0"),id:rB.union([rB.string(),rB.number().int()])}).merge(nx).strict()),nR=rB.object({jsonrpc:rB.literal("2.0"),id:rB.union([rB.string(),rB.number().int()]),result:nb}).strict(),nO=rB.object({jsonrpc:rB.literal("2.0"),id:rB.union([rB.string(),rB.number().int()]),error:rB.object({code:rB.number().int(),message:rB.string(),data:rB.optional(rB.unknown())})}).strict(),nP=rB.object({jsonrpc:rB.literal("2.0")}).merge(rB.object({method:rB.string(),params:rB.optional(nb)})).strict(),nM=rB.union([nC,nP,nR,nO]);function nZ(e={}){let t=new TextEncoder,r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(a,s){s.enqueue(t.encode(a)),r+=a,e.onToken&&await e.onToken(a),e.onText&&"string"==typeof a&&await e.onText(a)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function n$(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;if("string"==typeof e){t.enqueue(e);return}if("event"in e){"on_chat_model_stream"===e.event&&nL(null==(r=e.data)?void 0:r.chunk,t);return}nL(e,t)}})).pipeThrough(nZ(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(aO("text",e))}}))}function nD(e,t){return n$(e,t).pipeThrough(new TextEncoderStream)}function nF(e,t){var r;let a=n$(e,null==t?void 0:t.callbacks).pipeThrough(new TextEncoderStream),s=null==t?void 0:t.data,n=null==t?void 0:t.init;return new Response(s?nm(s.stream,a):a,{status:null!=(r=null==n?void 0:n.status)?r:200,statusText:null==n?void 0:n.statusText,headers:aD(null==n?void 0:n.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function nq(e,t){t.dataStream.merge(n$(e,t.callbacks))}function nL(e,t){if("string"==typeof e.content)t.enqueue(e.content);else for(let r of e.content)"text"===r.type&&t.enqueue(r.text)}function nU(e,t){var r;let a;let s=(a=!0,e=>(a&&(e=e.trimStart())&&(a=!1),e));return(r=e[Symbol.asyncIterator](),new ReadableStream({async pull(e){try{let{value:t,done:a}=await r.next();a?e.close():e.enqueue(t)}catch(t){e.error(t)}},cancel(){}})).pipeThrough(new TransformStream({async transform(e,t){t.enqueue(s(e.delta))}})).pipeThrough(nZ(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(aO("text",e))}}))}function nz(e,t){return nU(e,t).pipeThrough(new TextEncoderStream)}function nB(e,t={}){var r;let{init:a,data:s,callbacks:n}=t,i=nU(e,n).pipeThrough(new TextEncoderStream);return new Response(s?nm(s.stream,i):i,{status:null!=(r=null==a?void 0:a.status)?r:200,statusText:null==a?void 0:a.statusText,headers:aD(null==a?void 0:a.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function nV(e,t){t.dataStream.merge(nU(e,t.callbacks))}a$({},{mergeIntoDataStream:()=>nq,toDataStream:()=>nD,toDataStreamResponse:()=>nF}),a$({},{mergeIntoDataStream:()=>nV,toDataStream:()=>nz,toDataStreamResponse:()=>nB});var nJ=r(3489),nK=r(354);let nW="yq9j1nFMijszhDfTqFxT4tzPiCKtzomj";nW||console.error("Mistral API key is missing!");try{s=r1({apiKey:nW}),console.log("Mistral client initialized successfully.")}catch(e){console.error("Failed to initialize Mistral client:",e)}async function nY(e){if(console.log("Received POST request to /api/chat (Mistral)"),!s)return console.error("Mistral client is not initialized."),nJ.NextResponse.json({error:"AI service initialization failed"},{status:500});try{let t=await e.json();if(console.log("Received body:",JSON.stringify(t)),"object"!=typeof t||null===t||!("messages"in t)||!Array.isArray(t.messages))return console.error("Invalid request body structure or missing 'messages' array:",t),nJ.NextResponse.json({error:"Invalid request body: 'messages' array not found or invalid"},{status:400});let r=t.messages;if(0===r.length)return console.error("Invalid request body received: messages array is empty"),nJ.NextResponse.json({error:"Invalid request body: messages array is empty"},{status:400});let a=r[r.length-1]?.content;if(!a)return console.error("No user query found in messages"),nJ.NextResponse.json({error:"No user query found"},{status:400});console.log("User query:",a);let n=function(e){let t=e.toLowerCase().split(/\s+/).filter(e=>e.length>2&&!["is","the","for","and","a","of","to","in"].includes(e));return 0===t.length?[]:Object.values(nK).map(e=>{let r=e.name.toLowerCase(),a=e.content.toLowerCase(),s=0;t.forEach(e=>{r.includes(e)&&(s+=2),a.includes(e)&&(s+=1)});let n=t.filter(e=>r.includes(e)).length,i=t.filter(e=>a.includes(e)).length;return n>1&&(s+=2*n),i>1&&(s+=i),{protocol:e,score:s}}).filter(e=>e.score>0).sort((e,t)=>t.score-e.score).slice(0,5).map(e=>e.protocol)}(a);console.log(`Found ${n.length} relevant protocols.`),n.forEach((e,t)=>console.log(`  ${t+1}. ${e.name} (Source: ${e.source_file})`));let i=n.map(e=>`Protocol ${e.name} (Source: ${e.source_file}):
${e.content}`).join("\n\n---\n\n"),o=`You are an AI assistant specialized in the Oakland County EMS protocols. Your knowledge base consists ONLY of the following protocols provided below. Your primary goal is to help the user find the most relevant protocol based on their query.

Understand the user's intent even if their wording doesn't exactly match the protocol titles or content. Consider synonyms, related medical concepts, and the overall context.

Based *strictly* on the provided protocols, answer the user's question or identify the most relevant protocol(s). If an exact match isn't found, identify and present the protocol(s) that are semantically closest or most likely related to the user's query. If no relevant protocols can be found even considering related concepts, state that clearly. Do not invent information or use external knowledge. Be concise and helpful.

Relevant Protocols:
${i||"No specific protocols found matching the query."}`;console.log("Sending request to Mistral via Vercel AI SDK...");let l=await function({model:e,tools:t,toolChoice:r,system:a,prompt:s,messages:n,maxRetries:i,abortSignal:o,headers:l,maxSteps:u=1,experimental_generateMessageId:c=nf,experimental_output:d,experimental_continueSteps:p=!1,experimental_telemetry:m,experimental_providerMetadata:h,providerOptions:f=h,experimental_toolCallStreaming:g=!1,toolCallStreaming:y=g,experimental_activeTools:v,experimental_repairToolCall:_,experimental_transform:b,onChunk:x,onError:w,onFinish:k,onStepFinish:T,_internal:{now:S=function(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()},generateId:I=nh,currentDate:E=()=>new Date}={},...A}){return new ng({model:e,telemetry:m,headers:l,settings:A,maxRetries:i,abortSignal:o,system:a,prompt:s,messages:n,tools:t,toolChoice:r,toolCallStreaming:y,transforms:void 0===b?[]:Array.isArray(b)?b:[b],activeTools:v,repairToolCall:_,maxSteps:u,output:d,continueSteps:p,providerOptions:f,onChunk:x,onError:w,onFinish:k,onStepFinish:T,now:S,currentDate:E,generateId:I,generateMessageId:c})}({model:s("mistral-small-latest"),system:o,messages:r.slice(-5),temperature:.5,maxTokens:1e3});return console.log("Received stream response from Mistral."),l.toDataStreamResponse()}catch(t){console.error("Detailed Error processing chat request with Mistral:",t);let e="Internal Server Error";return t instanceof Error&&(e=t.message,t.name),console.error("Error Details:",e),nJ.NextResponse.json({error:e},{status:500})}}let nG=new q.AppRouteRouteModule({definition:{kind:L.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/home/ubuntu/ocmca_protocol_app/src/app/api/chat/route.ts",nextConfigOutput:"",userland:F}),{workAsyncStorage:nH,workUnitAsyncStorage:nX,serverHooks:nQ}=nG;function n0(){return(0,U.patchFetch)({workAsyncStorage:nH,workUnitAsyncStorage:nX})}},6648:e=>{let t="undefined"!=typeof Buffer,r=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,a=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function s(e,s,i){null==i&&null!==s&&"object"==typeof s&&(i=s,s=void 0),t&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let o=JSON.parse(e,s);if(null===o||"object"!=typeof o)return o;let l=i&&i.protoAction||"error",u=i&&i.constructorAction||"error";if("ignore"===l&&"ignore"===u)return o;if("ignore"!==l&&"ignore"!==u){if(!1===r.test(e)&&!1===a.test(e))return o}else if("ignore"!==l&&"ignore"===u){if(!1===r.test(e))return o}else if(!1===a.test(e))return o;return n(o,{protoAction:l,constructorAction:u,safe:i&&i.safe})}function n(e,{protoAction:t="error",constructorAction:r="error",safe:a}={}){let s=[e];for(;s.length;){let e=s;for(let n of(s=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(n,"__proto__")){if(!0===a)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete n.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype")){if(!0===a)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete n.constructor}for(let e in n){let t=n[e];t&&"object"==typeof t&&s.push(t)}}}return e}function i(e,t,r){let a=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,r)}finally{Error.stackTraceLimit=a}}e.exports=i,e.exports.default=i,e.exports.parse=i,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=n}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[0,32,154],()=>r(2834));module.exports=a})();